{"version":3,"file":"js/epubreader.js","mappings":";;;;;AAAa;;AAEb;AACA;;;;;;;;ACHa;;AAEb,eAAe,mBAAO,CAAC,GAAG;AAC1B,eAAe,mBAAO,CAAC,GAA+B;;AAEtD;AACA;AACA;AACA;AACA,mBAAmB;;AAEnB;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,cAAc,4BAA4B;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,OAAO;;AAErB;AACA,cAAc,2BAA2B;AACzC;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B;;AAE1B;AACA;AACA;AACA,eAAe;;;;;;;;ACnIF;;AAEb,kBAAkB,mBAAO,CAAC,GAAiB;;AAE3C;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;;;;;;;AClBa;;AAEb,iBAAiB,mBAAO,CAAC,GAAkB,oBAAoB,mBAAO,CAAC,GAAQ;;;;;;;;ACFlE;;AAEb,cAAc,mBAAO,CAAC,GAAY;;AAElC;AACA;AACA;AACA;;;;;;;;ACPa;;AAEb,cAAc,mBAAO,CAAC,GAAY;;AAElC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;;;;;;;ACnBa;;AAEb;AACA;;AAEA,oCAAoC;;;;;;;;ACLvB;;AAEb,cAAc,mBAAO,CAAC,GAAa;;AAEnC;AACA,sBAAsB;;AAEtB;AACA;AACA;AACA;;;;;;;;ACVa;;AAEb,eAAe,mBAAO,CAAC,GAAc;;AAErC;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;ACZa;;AAEb,iBAAiB,mBAAO,CAAC,GAAkB,kCAAkC,mBAAO,CAAC,GAAQ;;;;;;;;ACFhF;;AAEb,cAAc,mBAAO,CAAC,GAAa;;AAEnC;;AAEA,qCAAqC;;;;;;;;ACNxB;;AAEb,sBAAsB,mBAAO,CAAC,GAAe;AAC7C,sBAAsB,mBAAO,CAAC,GAAwB;AACtD,sBAAsB,mBAAO,CAAC,GAAuB;AACrD,sBAAsB,mBAAO,CAAC,GAAkC;AAChE,sBAAsB,mBAAO,CAAC,GAA2B;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,UAAU;AACV;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,UAAU;AACV;AACA;;;;;;;;AC7Da;;AAEb;AACA;AACA;AACA,SAAS;AACT,eAAe,YAAY,IAAI,cAAc;AAC7C;AACA;;;;;;;;ACRa;;AAEb;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;ACTa;;AAEb;AACA;AACA;AACA;;;;;;;;ACLa;;AAEb;;AAEA;AACA;AACA;;;;;;;;ACNa;;AAEb;;AAEA;AACA;AACA;AACA;;;;;;;;ACPa;;AAEb,YAAY,mBAAO,CAAC,EAAS;AAC7B,YAAY,mBAAO,CAAC,GAAgB;AACpC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,aAAa,YAAY;AACzB;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtBa;;AAEb,iBAAiB,mBAAO,CAAC,GAAkB,sBAAsB,mBAAO,CAAC,GAAQ;;;;;;;;ACFpE;;AAEb,iBAAiB,mBAAO,CAAC,EAAkB,KAAK;;AAEhD,kCAAkC;;;;;;;;ACJrB;;AAEb,iBAAiB,mBAAO,CAAC,EAAgB;;AAEzC,4BAA4B,EAAE;;AAE9B;AACA;AACA;AACA;AACA;;;;;;;SCVA;SACA;;SAEA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;;SAEA;SACA;;SAEA;SACA;SACA;;;;;UCtBA;UACA;UACA;UACA;UACA,yCAAyC,wCAAwC;UACjF;UACA;UACA;;;;;UCPA;;;;;UCAA;UACA;UACA;UACA,uDAAuD,iBAAiB;UACxE;UACA,gDAAgD,aAAa;UAC7D;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzDO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,mBAAmB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,mBAAmB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,mBAAmB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,mBAAmB;AACpD;AACA;AACA;;ACnGO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,YAAY;AACZ;;AC9MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,sBAAsB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,oBAAoB,qBAAqB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,sBAAsB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,WAAW,GAAG;AACd,WAAW,GAAG;AACd;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,KAAK;AAC1D,IAAI;AACJ;AACA,qDAAqD,KAAK;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,eAAe;AAC1B;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACO;AACP;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,sBAAsB;AACxC;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3vByC;AACzC;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,KAAK;AACzB,wBAAwB,KAAK;AAC7B,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,KAAK;AACtB,iBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,KAAK;AACtB,iBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,KAAK;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC;AAChC,KAAK;AACL;AACA;AACA;AACA;AACA,2BAA2B,KAAK;AAChC,qBAAqB,OAAO;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,KAAK;AAC1B,qBAAqB,OAAO;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,KAAK;AAClC,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AC1NwC;AACxC;AACO;AACP;AACA;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA;AACA,cAAc,KAAK;AACnB;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;AACA;AACA;AACA,qBAAqB,KAAK;AAC1B;AACA;AACA;AACA;AACA,cAAc,KAAK;AACnB;AACA;AACA;AACA;AACA;AACA,gBAAgB,MAAM;AACtB;AACA;AACA;AACA,qBAAqB,KAAK;AAC1B,sBAAsB,KAAK;AAC3B,sBAAsB,KAAK;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,uBAAuB,6BAA6B;AACpD;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,uBAAuB,6BAA6B;AACpD;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;ACrHyF;AACzF;AACO,uBAAuB,OAAO;AACrC;AACA;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B;AACA,6BAA6B;AAC7B;AACA,eAAe,KAAK;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B,oBAAoB,MAAM;AAC1B,oBAAoB,MAAM;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;ACzFyG;AACzG;AACO,6BAA6B,OAAO;AAC3C;AACA;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA;AACA;AACA,0BAA0B,MAAM;AAChC,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,KAAK;AACpB;AACA,uBAAuB,MAAM;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA;AACA;AACA,0CAA0C;AAC1C,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB,mBAAmB,MAAM;AACzB,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvI8G;AAC9G;AACO,+BAA+B,OAAO;AAC7C;AACA;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA;AACA;AACA,0BAA0B,MAAM;AAChC,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;AACA,eAAe,KAAK;AACpB;AACA,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB,mBAAmB,MAAM;AACzB,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,4BAA4B;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AC5GkF;AAClF;AACO,0BAA0B,OAAO;AACxC;AACA;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA,qBAAqB,OAAO;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB;AACA,gBAAgB,KAAK;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,GAAG;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,MAAM;AACzB,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzEsG;AACtG;AACO,4BAA4B,OAAO;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,MAAM;AAChC,eAAe,KAAK;AACpB;AACA,4BAA4B,OAAO;AACnC,0BAA0B,KAAK;AAC/B,uBAAuB,QAAQ;AAC/B;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,OAAO;AACnC,0BAA0B,KAAK;AAC/B,uBAAuB,QAAQ;AAC/B;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,OAAO;AAC/B,sBAAsB,KAAK;AAC3B,mBAAmB,QAAQ;AAC3B;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,QAAQ;AACrC,0BAA0B,OAAO;AACjC,wBAAwB,KAAK;AAC7B,qBAAqB,QAAQ;AAC7B;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,OAAO;AACzC,gCAAgC,KAAK;AACrC;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,KAAK;AACjC,yBAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,OAAO;AAC/B;AACA;AACA,eAAe,KAAK;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;ACzKyE;AACzE;AACO,4BAA4B,OAAO;AAC1C;AACA;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B,eAAe,KAAK;AACpB;AACA;AACA,mBAAmB,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,MAAM;AAC1B,qBAAqB,MAAM;AAC3B,qBAAqB,MAAM;AAC3B;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AChEwD;AACZ;AACY;AACI;AACV;AACI;AACA;AACtD;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,aAAa;AACrC;AACA,wBAAwB,KAAK;AAC7B,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD,QAAQ;AAC9D;AACA,uDAAuD,cAAc;AACrE;AACA;AACA,uDAAuD,gBAAgB;AACvE;AACA,sDAAsD,WAAW;AACjE,sDAAsD,aAAa;AACnE,sDAAsD,aAAa;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AC9EkC;AACuB;AACzD;AACO;AACP;AACA;AACA;AACA,8BAA8B,KAAK;AACnC;AACA;AACA;AACA;AACA;AACA,0BAA0B,OAAO;AACjC,4BAA4B,OAAO;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,IAAI;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,KAAK;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;ACvEyC;AACzC;AACkD;AACX;AACA;AACA;AACA;AACA;AACA;AACvC;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,sBAAsB,OAAO;AAC7B,sBAAsB,OAAO;AAC7B,sBAAsB,OAAO;AAC7B,sBAAsB,OAAO;AAC7B;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA;AACA;AACA,kBAAkB,YAAY;AAC9B,qBAAqB,OAAO;AAC5B;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,GAAG;AACf,YAAY,GAAG;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,GAAG;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,KAAK;AACjB,YAAY,KAAK;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,EAAE,MAAM,eAAe;AACvB;AACA;AACA,yCAAyC;AACzC,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,GAAG;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,GAAG,MAAM;AACT;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,iBAAiB;AAClD;AACA;AACA;AACA,iCAAiC,iBAAiB;AAClD;AACA;AACA;AACA,iCAAiC,iBAAiB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,mB","sources":["webpack://epubreader-js/./node_modules/es5-ext/function/noop.js","webpack://epubreader-js/./node_modules/event-emitter/index.js","webpack://epubreader-js/./node_modules/type/function/is.js","webpack://epubreader-js/./node_modules/es5-ext/object/keys/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/valid-value.js","webpack://epubreader-js/./node_modules/es5-ext/object/normalize-options.js","webpack://epubreader-js/./node_modules/type/value/is.js","webpack://epubreader-js/./node_modules/type/object/is.js","webpack://epubreader-js/./node_modules/type/prototype/is.js","webpack://epubreader-js/./node_modules/es5-ext/string/\u0000#/contains/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/keys/shim.js","webpack://epubreader-js/./node_modules/d/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/assign/is-implemented.js","webpack://epubreader-js/./node_modules/es5-ext/object/keys/is-implemented.js","webpack://epubreader-js/./node_modules/es5-ext/object/valid-callable.js","webpack://epubreader-js/./node_modules/es5-ext/string/\u0000#/contains/shim.js","webpack://epubreader-js/./node_modules/es5-ext/string/\u0000#/contains/is-implemented.js","webpack://epubreader-js/./node_modules/es5-ext/object/assign/shim.js","webpack://epubreader-js/./node_modules/es5-ext/object/assign/index.js","webpack://epubreader-js/./node_modules/es5-ext/object/is-value.js","webpack://epubreader-js/./node_modules/type/plain-function/is.js","webpack://epubreader-js/webpack/bootstrap","webpack://epubreader-js/webpack/runtime/define property getters","webpack://epubreader-js/webpack/runtime/hasOwnProperty shorthand","webpack://epubreader-js/webpack/runtime/make namespace object","webpack://epubreader-js/./src/utils.js","webpack://epubreader-js/./src/storage.js","webpack://epubreader-js/./src/strings.js","webpack://epubreader-js/./src/ui.js","webpack://epubreader-js/./src/toolbar.js","webpack://epubreader-js/./src/content.js","webpack://epubreader-js/./src/sidebar/toc.js","webpack://epubreader-js/./src/sidebar/bookmarks.js","webpack://epubreader-js/./src/sidebar/annotations.js","webpack://epubreader-js/./src/sidebar/search.js","webpack://epubreader-js/./src/sidebar/settings.js","webpack://epubreader-js/./src/sidebar/metadata.js","webpack://epubreader-js/./src/sidebar.js","webpack://epubreader-js/./src/notedlg.js","webpack://epubreader-js/./src/reader.js"],"sourcesContent":["\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","\"use strict\";\n\nvar isPrototype = require(\"../prototype/is\");\n\nmodule.exports = function (value) {\n\tif (typeof value !== \"function\") return false;\n\n\tif (!hasOwnProperty.call(value, \"length\")) return false;\n\n\ttry {\n\t\tif (typeof value.length !== \"number\") return false;\n\t\tif (typeof value.call !== \"function\") return false;\n\t\tif (typeof value.apply !== \"function\") return false;\n\t} catch (error) {\n\t\treturn false;\n\t}\n\n\treturn !isPrototype(value);\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","\"use strict\";\n\n// ES3 safe\nvar _undefined = void 0;\n\nmodule.exports = function (value) { return value !== _undefined && value !== null; };\n","\"use strict\";\n\nvar isValue = require(\"../value/is\");\n\n// prettier-ignore\nvar possibleTypes = { \"object\": true, \"function\": true, \"undefined\": true /* document.all */ };\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\treturn hasOwnProperty.call(possibleTypes, typeof value);\n};\n","\"use strict\";\n\nvar isObject = require(\"../object/is\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) return false;\n\ttry {\n\t\tif (!value.constructor) return false;\n\t\treturn value.constructor.prototype === value;\n\t} catch (error) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? String.prototype.contains : require(\"./shim\");\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\nvar isValue         = require(\"type/value/is\")\n  , isPlainFunction = require(\"type/plain-function/is\")\n  , assign          = require(\"es5-ext/object/assign\")\n  , normalizeOpts   = require(\"es5-ext/object/normalize-options\")\n  , contains        = require(\"es5-ext/string/#/contains\");\n\nvar d = (module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif (arguments.length < 2 || typeof dscr !== \"string\") {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t\tw = contains.call(dscr, \"w\");\n\t} else {\n\t\tc = w = true;\n\t\te = false;\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n});\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== \"string\") {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (!isValue(get)) {\n\t\tget = undefined;\n\t} else if (!isPlainFunction(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (!isValue(set)) {\n\t\tset = undefined;\n\t} else if (!isPlainFunction(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t} else {\n\t\tc = true;\n\t\te = false;\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn obj.foo + obj.bar + obj.trzy === \"razdwatrzy\";\n};\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString /*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn str.contains(\"dwa\") === true && str.contains(\"foo\") === false;\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.assign : require(\"./shim\");\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) { return val !== _undefined && val !== null; };\n","\"use strict\";\n\nvar isFunction = require(\"../function/is\");\n\nvar classRe = /^\\s*class[\\s{/}]/, functionToString = Function.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isFunction(value)) return false;\n\tif (classRe.test(functionToString.call(value))) return false;\n\treturn true;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const d = (obj, prop) => obj ? obj[prop] : undefined\r\n\r\nconst q = (src, dst, ext, prop) => {\r\n    let val\r\n    if (typeof dst[prop] === \"boolean\") {\r\n        switch (prop) {\r\n            case \"annotations\":\r\n            case \"bookmarks\":\r\n                val = dst[prop] ? src[prop] : dst[prop]\r\n                break;\r\n            default:\r\n                val = dst[prop]\r\n                break;\r\n        }\r\n    } else if (prop === \"arrows\") {\r\n        val = dst[prop]\r\n    } else {\r\n        val = d(ext, prop) === undefined ? src[prop] : dst[prop]\r\n    }\r\n    return val\r\n}\r\n\r\nexport const extend = (src, dst, ext) => {\r\n    for (let prop in src) {\r\n        if (prop === \"bookPath\") {\r\n            continue\r\n        } else if (dst[prop] instanceof Array) {\r\n            dst[prop] = ext ? (src[prop] ? src[prop] : dst[prop]) : src[prop]\r\n        } else if (dst[prop] instanceof Object) {\r\n            extend(src[prop], dst[prop], d(ext, prop)) // recursive call\r\n        } else {\r\n            dst[prop] = ext ? q(src, dst, ext, prop) : src[prop]\r\n        }\r\n    }\r\n}\r\n\r\nexport const uuid = () => {\r\n    let d = new Date().getTime()\r\n    const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\r\n        let r = (d + Math.random() * 16) % 16 | 0\r\n        d = Math.floor(d / 16)\r\n        return (c === \"x\" ? r : (r & 0x7 | 0x8)).toString(16)\r\n    })\r\n    return uuid\r\n}\r\n\r\nexport const detectMobile = () => {\r\n    const matches = [\r\n        /Android/i,\r\n        /BlackBerry/i,\r\n        /iPhone/i,\r\n        /iPad/i,\r\n        /iPod/i,\r\n        /Windows Phone/i,\r\n        /webOS/i\r\n    ]\r\n    return matches.some((i) => navigator.userAgent.match(i))\r\n}","export class Storage {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.name = \"epubreader-js\";\r\n\t\tthis.version = 1.0;\r\n\t\tthis.db;\r\n\t\tthis.indexedDB = window.indexedDB ||\r\n\t\t\twindow.webkitIndexedDB ||\r\n\t\t\twindow.mozIndexedDB ||\r\n\t\t\twindow.OIndexedDB ||\r\n\t\t\twindow.msIndexedDB;\r\n\r\n\t\tif (this.indexedDB === undefined) {\r\n\r\n\t\t\tconsole.error(\"The IndexedDB API not available in your browser.\");\r\n\t\t}\r\n\t}\r\n\r\n\tinit(callback) {\r\n\r\n\t\tif (this.indexedDB === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst time = Date.now();\r\n\t\tconst onerror = (e) => console.error(\"IndexedDB\", e);\r\n\t\tconst request = indexedDB.open(this.name, this.version);\r\n\t\trequest.onupgradeneeded = (e) => {\r\n\r\n\t\t\tconst db = e.target.result;\r\n\t\t\tif (db.objectStoreNames.contains(\"entries\") === false) {\r\n\t\t\t\tdb.createObjectStore(\"entries\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trequest.onsuccess = (e) => {\r\n\r\n\t\t\tthis.db = e.target.result;\r\n\t\t\tthis.db.onerror = onerror;\r\n\t\t\tcallback();\r\n\t\t\tconsole.log(`storage.init: ${Date.now() - time} ms`);\r\n\t\t}\r\n\r\n\t\trequest.onerror = onerror;\r\n\t}\r\n\r\n\tget(callback) {\r\n\r\n\t\tif (this.db === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst time = Date.now();\r\n\t\tconst transaction = this.db.transaction([\"entries\"], \"readwrite\");\r\n\t\tconst objectStore = transaction.objectStore(\"entries\");\r\n\t\tconst request = objectStore.get(0);\r\n\t\trequest.onsuccess = (e) => {\r\n\r\n\t\t\tcallback(e.target.result);\r\n\t\t\tconsole.log(`storage.get: ${Date.now() - time} ms`);\r\n\t\t}\r\n\t}\r\n\r\n\tset(data, callback) {\r\n\r\n\t\tif (this.db === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst time = Date.now();\r\n\t\tconst transaction = this.db.transaction([\"entries\"], \"readwrite\");\r\n\t\tconst objectStore = transaction.objectStore(\"entries\");\r\n\t\tconst request = objectStore.put(data, 0);\r\n\t\trequest.onsuccess = () => {\r\n\r\n\t\t\tcallback();\r\n\t\t\tconsole.log(`storage.set: ${Date.now() - time} ms`);\r\n\t\t}\r\n\t}\r\n\r\n\tclear() {\r\n\r\n\t\tif (this.db === undefined) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst time = Date.now();\r\n\t\tconst transaction = this.db.transaction([\"entries\"], \"readwrite\");\r\n\t\tconst objectStore = transaction.objectStore(\"entries\");\r\n\t\tconst request = objectStore.clear();\r\n\t\trequest.onsuccess = () => {\r\n\r\n\t\t\tconsole.log(`storage.clear: ${Date.now() - time} ms`);\r\n\t\t}\r\n\t}\r\n}","export class Strings {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tthis.language = reader.settings.language || \"en\";\r\n\t\tthis.values = {\r\n\t\t\ten: {\r\n\t\t\t\t\"toolbar/sidebar\": \"Sidebar\",\r\n\t\t\t\t\"toolbar/prev\": \"Previous page\",\r\n\t\t\t\t\"toolbar/next\": \"Next page\",\r\n\t\t\t\t\"toolbar/openbook\": \"Open book\",\r\n\t\t\t\t\"toolbar/openbook/error\": \"Your browser does not support the required features.\\nPlease use a modern browser such as Google Chrome, or Mozilla Firefox.\",\r\n\t\t\t\t\"toolbar/bookmark\": \"Add this page to bookmarks\",\r\n\t\t\t\t\"toolbar/fullscreen\": \"Fullscreen\",\r\n\r\n\t\t\t\t\"sidebar/close\": \"Close Sidebar\",\r\n\t\t\t\t\"sidebar/contents\": \"Contents\",\r\n\t\t\t\t\"sidebar/bookmarks\": \"Bookmarks\",\r\n\t\t\t\t\"sidebar/bookmarks/add\": \"Add\",\r\n\t\t\t\t\"sidebar/bookmarks/remove\": \"Remove\",\r\n\t\t\t\t\"sidebar/bookmarks/clear\": \"Clear\",\r\n\t\t\t\t\"sidebar/annotations\": \"Annotations\",\r\n\t\t\t\t\"sidebar/annotations/add\": \"Add\",\r\n\t\t\t\t\"sidebar/annotations/remove\": \"Remove\",\r\n\t\t\t\t\"sidebar/annotations/clear\": \"Clear\",\r\n\t\t\t\t\"sidebar/annotations/anchor\": \"Anchor\",\r\n\t\t\t\t\"sidebar/annotations/cancel\": \"Cancel\",\r\n\t\t\t\t\"sidebar/search\": \"Search\",\r\n\t\t\t\t\"sidebar/search/placeholder\": \"Search\",\r\n\t\t\t\t\"sidebar/settings\": \"Settings\",\r\n\t\t\t\t\"sidebar/settings/language\": \"Language\",\r\n\t\t\t\t\"sidebar/settings/fontsize\": \"Font size (%)\",\r\n\t\t\t\t\"sidebar/settings/flow\": \"Flow\",\r\n\t\t\t\t\"sidebar/settings/pagination\": [\"Pagination\", \"Generate pagination\"],\r\n\t\t\t\t\"sidebar/settings/spread\": \"Spread\",\r\n\t\t\t\t\"sidebar/settings/spread/minwidth\": \"Minimum spread width\",\r\n\t\t\t\t\"sidebar/metadata\": \"Metadata\",\r\n\t\t\t\t\"sidebar/metadata/title\": \"Title\",\r\n\t\t\t\t\"sidebar/metadata/creator\": \"Creator\",\r\n\t\t\t\t\"sidebar/metadata/description\": \"Description\",\r\n\t\t\t\t\"sidebar/metadata/pubdate\": \"Pubdate\",\r\n\t\t\t\t\"sidebar/metadata/publisher\": \"Publisher\",\r\n\t\t\t\t\"sidebar/metadata/identifier\": \"Identifier\",\r\n\t\t\t\t\"sidebar/metadata/language\": \"Language\",\r\n\t\t\t\t\"sidebar/metadata/rights\": \"Rights\",\r\n\t\t\t\t\"sidebar/metadata/modified_date\": \"Modified date\",\r\n\t\t\t\t\"sidebar/metadata/layout\": \"Layout\", // rendition:layout\r\n\t\t\t\t\"sidebar/metadata/flow\": \"Flow\", // rendition:flow\r\n\t\t\t\t\"sidebar/metadata/spread\": \"Spread\", // rendition:spread\r\n\t\t\t\t\"sidebar/metadata/direction\": \"Direction\", // page-progression-direction\r\n\r\n\t\t\t\t\"notedlg/label\": \"Note\",\r\n\t\t\t\t\"notedlg/add\": \"Add\"\r\n\t\t\t},\r\n\t\t\tfr: {\r\n\t\t\t\t\"toolbar/sidebar\": \"Barre latérale\",\r\n\t\t\t\t\"toolbar/prev\": \"???\",\r\n\t\t\t\t\"toolbar/next\": \"???\",\r\n\t\t\t\t\"toolbar/openbook\": \"Ouvrir un livre local\",\r\n\t\t\t\t\"toolbar/openbook/error\": \"Votre navigateur ne prend pas en charge les fonctions nécessaires.\\nVeuillez utiliser un navigateur moderne tel que Google Chrome ou Mozilla Firefox.\",\r\n\t\t\t\t\"toolbar/bookmark\": \"Insérer un marque page ici\",\r\n\t\t\t\t\"toolbar/fullscreen\": \"Plein écran\",\r\n\r\n\t\t\t\t\"sidebar/close\": \"???\",\r\n\t\t\t\t\"sidebar/contents\": \"Sommaire\",\r\n\t\t\t\t\"sidebar/bookmarks\": \"Marque-pages\",\r\n\t\t\t\t\"sidebar/bookmarks/add\": \"Ajouter\",\r\n\t\t\t\t\"sidebar/bookmarks/remove\": \"Retirer\",\r\n\t\t\t\t\"sidebar/bookmarks/clear\": \"Tout enlever\",\r\n\t\t\t\t\"sidebar/annotations\": \"Annotations\",\r\n\t\t\t\t\"sidebar/annotations/add\": \"Ajouter\",\r\n\t\t\t\t\"sidebar/annotations/remove\": \"Retirer\",\r\n\t\t\t\t\"sidebar/annotations/clear\": \"Tout enlever\",\r\n\t\t\t\t\"sidebar/annotations/anchor\": \"Ancre\",\r\n\t\t\t\t\"sidebar/annotations/cancel\": \"Annuler\",\r\n\t\t\t\t\"sidebar/search\": \"Rechercher\",\r\n\t\t\t\t\"sidebar/search/placeholder\": \"rechercher\",\r\n\t\t\t\t\"sidebar/settings\": \"Réglages\",\r\n\t\t\t\t\"sidebar/settings/language\": \"Langue\",\r\n\t\t\t\t\"sidebar/settings/fontsize\": \"???\",\r\n\t\t\t\t\"sidebar/settings/flow\": \"???\",\r\n\t\t\t\t\"sidebar/settings/pagination\": [\"Pagination\", \"Établir une pagination\"],\r\n\t\t\t\t\"sidebar/settings/spread\": \"???\",\r\n\t\t\t\t\"sidebar/settings/spread/minwidth\": \"???\",\r\n\t\t\t\t\"sidebar/metadata\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/title\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/creator\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/description\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/pubdate\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/publisher\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/identifier\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/language\": \"Langue\",\r\n\t\t\t\t\"sidebar/metadata/rights\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/modified_date\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/layout\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/flow\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/spread\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/direction\": \"???\",\r\n\r\n\t\t\t\t\"notedlg/label\": \"???\",\r\n\t\t\t\t\"notedlg/add\": \"Ajouter\"\r\n\t\t\t},\r\n\t\t\tja: {\r\n\t\t\t\t\"toolbar/sidebar\": \"サイドバー\",\r\n\t\t\t\t\"toolbar/prev\": \"???\",\r\n\t\t\t\t\"toolbar/next\": \"???\",\r\n\t\t\t\t\"toolbar/openbook\": \"本を開く\",\r\n\t\t\t\t\"toolbar/openbook/error\": \"ご利用のブラウザは必要な機能をサポートしていません。\\nGoogle Chrome、Mozilla Firefox、その他のモダンなブラウザでご利用ください。\",\r\n\t\t\t\t\"toolbar/bookmark\": \"このページに栞を設定する\",\r\n\t\t\t\t\"toolbar/fullscreen\": \"フルスクリーン\",\r\n\r\n\t\t\t\t\"sidebar/close\": \"???\",\r\n\t\t\t\t\"sidebar/contents\": \"目次\",\r\n\t\t\t\t\"sidebar/bookmarks\": \"栞\",\r\n\t\t\t\t\"sidebar/bookmarks/add\": \"追加\",\r\n\t\t\t\t\"sidebar/bookmarks/remove\": \"削除\",\r\n\t\t\t\t\"sidebar/bookmarks/clear\": \"クリア\",\r\n\t\t\t\t\"sidebar/annotations\": \"注釈\",\r\n\t\t\t\t\"sidebar/annotations/add\": \"追加\",\r\n\t\t\t\t\"sidebar/bookmarks/remove\": \"削除\",\r\n\t\t\t\t\"sidebar/annotations/clear\": \"クリア\",\r\n\t\t\t\t\"sidebar/annotations/anchor\": \"アンカー\",\r\n\t\t\t\t\"sidebar/annotations/cancel\": \"キャンセル\",\r\n\t\t\t\t\"sidebar/search\": \"検索\",\r\n\t\t\t\t\"sidebar/search/placeholder\": \"検索\",\r\n\t\t\t\t\"sidebar/settings\": \"設定\",\r\n\t\t\t\t\"sidebar/settings/language\": \"表示言語\",\r\n\t\t\t\t\"sidebar/settings/fontsize\": \"???\",\r\n\t\t\t\t\"sidebar/settings/flow\": \"???\",\r\n\t\t\t\t\"sidebar/settings/pagination\": [\"ページネーション\", \"ページネーションを生成します。\"],\r\n\t\t\t\t\"sidebar/settings/spread\": \"???\",\r\n\t\t\t\t\"sidebar/settings/spread/minwidth\": \"???\",\r\n\t\t\t\t\"sidebar/metadata\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/title\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/creator\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/description\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/pubdate\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/publisher\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/identifier\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/language\": \"表示言語\",\r\n\t\t\t\t\"sidebar/metadata/rights\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/modified_date\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/layout\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/flow\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/spread\": \"???\",\r\n\t\t\t\t\"sidebar/metadata/direction\": \"???\",\r\n\r\n\t\t\t\t\"notedlg/label\": \"???\",\r\n\t\t\t\t\"notedlg/add\": \"追加\"\r\n\t\t\t},\r\n\t\t\tru: {\r\n\t\t\t\t\"toolbar/sidebar\": \"Боковая панель\",\r\n\t\t\t\t\"toolbar/prev\": \"Предыдущая страница\",\r\n\t\t\t\t\"toolbar/next\": \"Следущая страница\",\r\n\t\t\t\t\"toolbar/openbook\": \"Открыть книгу\",\r\n\t\t\t\t\"toolbar/openbook/error\": \"Ваш браузер не поддерживает необходимые функции.\\nПожалуйста, используйте современный браузер, такой как Google Chrome или Mozilla Firefox.\",\r\n\t\t\t\t\"toolbar/bookmark\": \"Добавить эту страницу в закладки\",\r\n\t\t\t\t\"toolbar/fullscreen\": \"Полноэкранный режим\",\r\n\r\n\t\t\t\t\"sidebar/close\": \"Закрыть боковую панель\",\r\n\t\t\t\t\"sidebar/contents\": \"Содержание\",\r\n\t\t\t\t\"sidebar/bookmarks\": \"Закладки\",\r\n\t\t\t\t\"sidebar/bookmarks/add\": \"Добавить\",\r\n\t\t\t\t\"sidebar/bookmarks/remove\": \"Удалить\",\r\n\t\t\t\t\"sidebar/bookmarks/clear\": \"Очистить\",\r\n\t\t\t\t\"sidebar/annotations\": \"Аннотации\",\r\n\t\t\t\t\"sidebar/annotations/add\": \"Добавить\",\r\n\t\t\t\t\"sidebar/annotations/remove\": \"Удалить\",\r\n\t\t\t\t\"sidebar/annotations/clear\": \"Очистить\",\r\n\t\t\t\t\"sidebar/annotations/anchor\": \"Метка\",\r\n\t\t\t\t\"sidebar/annotations/cancel\": \"Отмена\",\r\n\t\t\t\t\"sidebar/search\": \"Поиск\",\r\n\t\t\t\t\"sidebar/search/placeholder\": \"Поиск\",\r\n\t\t\t\t\"sidebar/settings\": \"Настройки\",\r\n\t\t\t\t\"sidebar/settings/language\": \"Язык\",\r\n\t\t\t\t\"sidebar/settings/fontsize\": \"Размер шрифта\",\r\n\t\t\t\t\"sidebar/settings/flow\": \"Поток\",\r\n\t\t\t\t\"sidebar/settings/pagination\": [\"Нумерация страниц\", \"Генерировать нумерацию страниц\"],\r\n\t\t\t\t\"sidebar/settings/spread\": \"Разворот\",\r\n\t\t\t\t\"sidebar/settings/spread/minwidth\": \"Мин. ширина колонки\",\r\n\t\t\t\t\"sidebar/metadata\": \"Метаданные\",\r\n\t\t\t\t\"sidebar/metadata/title\": \"Заголовок\",\r\n\t\t\t\t\"sidebar/metadata/creator\": \"Автор\",\r\n\t\t\t\t\"sidebar/metadata/description\": \"Описание\",\r\n\t\t\t\t\"sidebar/metadata/pubdate\": \"Дата публикации\",\r\n\t\t\t\t\"sidebar/metadata/publisher\": \"Издатель\",\r\n\t\t\t\t\"sidebar/metadata/identifier\": \"Идентификатор\",\r\n\t\t\t\t\"sidebar/metadata/language\": \"Язык\",\r\n\t\t\t\t\"sidebar/metadata/rights\": \"Лицензия\",\r\n\t\t\t\t\"sidebar/metadata/modified_date\": \"Дата изменения\",\r\n\t\t\t\t\"sidebar/metadata/layout\": \"Макет\",\r\n\t\t\t\t\"sidebar/metadata/flow\": \"Поток\",\r\n\t\t\t\t\"sidebar/metadata/spread\": \"Разворот\",\r\n\t\t\t\t\"sidebar/metadata/direction\": \"Направление\",\r\n\r\n\t\t\t\t\"notedlg/label\": \"Заметка\",\r\n\t\t\t\t\"notedlg/add\": \"Добавить\"\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\t\t\tthis.language = value;\r\n\t\t});\r\n\t}\r\n\r\n\tget(key) { return this.values[this.language][key] || \"???\"; }\r\n}","/**\r\n * @author mrdoob https://github.com/mrdoob/ui.js\r\n */\r\n\r\nconst ERROR_MSG = \"is not an instance of UIElement.\";\r\n\r\n/**\r\n * UIElement\r\n * @param {string} tag\r\n */\r\nexport class UIElement {\r\n\t\r\n\tconstructor(tag) {\r\n\r\n\t\tthis.dom = document.createElement(tag); \r\n\t}\r\n\r\n\tadd() {\r\n\r\n\t\tfor (let i = 0; i < arguments.length; i++) {\r\n\r\n\t\t\tconst argument = arguments[i];\r\n\r\n\t\t\tif (argument instanceof UIElement) {\r\n\r\n\t\t\t\tthis.dom.appendChild(argument.dom);\r\n\r\n\t\t\t} else if (Array.isArray(argument)) {\r\n\r\n\t\t\t\tfor (let j = 0; j < argument.length; j++) {\r\n\r\n\t\t\t\t\tconst element = argument[j];\r\n\r\n\t\t\t\t\tif (element instanceof UIElement) {\r\n\r\n\t\t\t\t\t\tthis.dom.appendChild(element.dom);\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.error(\"UIElement:\", element, ERROR_MSG);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error(\"UIElement:\", argument, ERROR_MSG);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tremove() {\r\n\r\n\t\tfor (let i = 0; i < arguments.length; i++) {\r\n\r\n\t\t\tconst argument = arguments[i];\r\n\r\n\t\t\tif (argument instanceof UIElement) {\r\n\r\n\t\t\t\tthis.dom.removeChild(argument.dom);\r\n\r\n\t\t\t} else if (Number.isInteger(argument)) {\r\n\r\n\t\t\t\tthis.dom.removeChild(this.dom.childNodes[argument]);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error(\"UIElement:\", argument, ERROR_MSG);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclear() {\r\n\r\n\t\twhile (this.dom.children.length) {\r\n\r\n\t\t\tthis.dom.removeChild(this.dom.lastChild);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetId(id) {\r\n\r\n\t\tthis.dom.id = id;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetId() {\r\n\r\n\t\treturn this.dom.id;\r\n\t}\r\n\r\n\tremoveAttribute(name) {\r\n\r\n\t\tthis.dom.removeAttribute(name);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetClass(name) {\r\n\r\n\t\tthis.dom.className = name;\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddClass(name) {\r\n\r\n\t\tthis.dom.classList.add(name);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tremoveClass(name) {\r\n\r\n\t\tthis.dom.classList.remove(name);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetStyle(key, value) {\r\n\r\n\t\tthis.dom.style[key] = value;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetTitle() {\r\n\r\n\t\treturn this.dom.title;\r\n\t}\r\n\r\n\tsetTitle(title) {\r\n\r\n\t\tif (this.dom.title !== title && title)\r\n\t\t\tthis.dom.title = title;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetTextContent() {\r\n\r\n\t\treturn this.dom.textContent;\r\n\t}\r\n\r\n\tsetTextContent(text) {\r\n\r\n\t\tif (this.dom.textContent !== text && text)\r\n\t\t\tthis.dom.textContent = text;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetBoundingClientRect() {\r\n\r\n\t\treturn this.dom.getBoundingClientRect();\r\n\t}\r\n}\r\n\r\n/**\r\n * UISpan\r\n * @param {string} text\r\n */\r\nexport class UISpan extends UIElement {\r\n\r\n\tconstructor(text) {\r\n\r\n\t\tsuper(\"span\");\r\n\t\tthis.setTextContent(text);\r\n\t}\r\n}\r\n\r\n/**\r\n * UIDiv\r\n */\r\nexport class UIDiv extends UIElement {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper(\"div\");\r\n\t}\r\n}\r\n\r\n/**\r\n * UIRow\r\n */\r\nexport class UIRow extends UIDiv {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.dom.className = \"row\";\r\n\t}\r\n}\r\n\r\n/**\r\n * UIPanel\r\n */\r\nexport class UIPanel extends UIDiv {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.dom.className = \"panel\";\r\n\t}\r\n}\r\n\r\n/**\r\n * UILabel\r\n * @param {string} text\r\n * @param {string} id\r\n */\r\nexport class UILabel extends UIElement {\r\n\r\n\tconstructor(text, id) {\r\n\r\n\t\tsuper(\"label\");\r\n\r\n\t\tthis.dom.textContent = text;\r\n\t\tif (id) this.dom.htmlFor = id;\r\n\t}\r\n}\r\n\r\n/**\r\n * UILink\r\n * @param {string} href\r\n * @param {string} text\r\n */\r\nexport class UILink extends UIElement {\r\n\r\n\tconstructor(href, text) {\r\n\r\n\t\tsuper(\"a\");\r\n\r\n\t\tthis.dom.href = href || \"#\";\r\n\t\tthis.dom.textContent = text || \"\";\r\n\t}\r\n\r\n\tsetHref(url) {\r\n\r\n\t\tthis.dom.href = url;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UIText\r\n * @param {string} text\r\n */\r\nexport class UIText extends UISpan {\r\n\r\n\tconstructor(text) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.dom.textContent = text;\r\n\t}\r\n\r\n\tgetValue() {\r\n\r\n\t\treturn this.dom.textContent;\r\n\t}\r\n\r\n\tsetValue(text) {\r\n\r\n\t\tthis.dom.textContent = text;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UITextArea\r\n */\r\nexport class UITextArea extends UIElement {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper(\"textarea\");\r\n\r\n\t\tthis.dom.spellcheck = false;\r\n\t\tthis.dom.onkeydown = (e) => {\r\n\r\n\t\t\te.stopPropagation();\r\n\t\t};\r\n\t}\r\n\r\n\tgetValue() {\r\n\r\n\t\treturn this.dom.value;\r\n\t}\r\n\r\n\tsetValue(value) {\r\n\r\n\t\tthis.dom.value = value;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UISelect\r\n */\r\nexport class UISelect extends UIElement {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper(\"select\");\r\n\t}\r\n\r\n\tsetMultiple(boolean) {\r\n\r\n\t\tthis.dom.multiple = boolean || false;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\r\n\t\tconst selected = this.dom.value;\r\n\t\tthis.clear();\r\n\r\n\t\tfor (const key in options) {\r\n\r\n\t\t\tconst option = document.createElement(\"option\");\r\n\t\t\toption.value = key;\r\n\t\t\toption.text = options[key];\r\n\t\t\tthis.dom.appendChild(option);\r\n\t\t}\r\n\t\tthis.dom.value = selected;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetValue() {\r\n\r\n\t\treturn this.dom.value;\r\n\t}\r\n\r\n\tsetValue(value) {\r\n\r\n\t\tvalue = String(value);\r\n\r\n\t\tif (this.dom.value !== value)\r\n\t\t\tthis.dom.value = value;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UIInput\r\n * @param {*} type\r\n * @param {*} value\r\n * @param {*} title\r\n */\r\nexport class UIInput extends UIElement {\r\n\r\n\tconstructor(type, value, title) {\r\n\r\n\t\tsuper(\"input\");\r\n\r\n\t\tthis.dom.type = type;\r\n\t\tthis.dom.onkeydown = (e) => {\r\n\r\n\t\t\te.stopPropagation();\r\n\t\t};\r\n\t\tthis.setValue(value);\r\n\t\tthis.setTitle(title);\r\n\t}\r\n\r\n\tgetName() {\r\n\r\n\t\treturn this.dom.name;\r\n\t}\r\n\r\n\tsetName(name) {\r\n\r\n\t\tthis.dom.name = name;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetType() {\r\n\r\n\t\treturn this.dom.type;\r\n\t}\r\n\r\n\tsetType(type) {\r\n\r\n\t\tthis.dom.type = type;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetValue() {\r\n\r\n\t\treturn this.dom.value;\r\n\t}\r\n\r\n\tsetValue(value) {\r\n\r\n\t\tif (this.dom.value !== value && value !== undefined)\r\n\t\t\tthis.dom.value = value;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UIColor\r\n */\r\nexport class UIColor extends UIElement {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper(\"input\");\r\n\r\n\t\ttry {\r\n\r\n\t\t\tthis.dom.type = \"color\";\r\n\t\t\tthis.dom.value = \"#ffffff\";\r\n\r\n\t\t} catch (e) {\r\n\r\n\t\t\tconsole.exception(e);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue() {\r\n\r\n\t\treturn this.dom.value;\r\n\t}\r\n\r\n\tgetHexValue() {\r\n\r\n\t\treturn parseInt(this.dom.value.substr(1), 16);\r\n\t}\r\n\r\n\tsetValue(value) {\r\n\r\n\t\tthis.dom.value = value;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetHexValue(hex) {\r\n\r\n\t\tthis.dom.value = \"#\" + (\"000000\" + hex.toString(16)).slice(-6);\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UINumber\r\n * @param {number} value\r\n * @param {number} step\r\n * @param {number} min\r\n * @param {number} max\r\n * @param {number} precision\r\n */\r\nexport class UINumber extends UIElement {\r\n\r\n\tconstructor(value, step, min, max, precision) {\r\n\r\n\t\tsuper(\"input\");\r\n\r\n\t\tthis.dom.type = \"number\";\r\n\t\tthis.dom.step = step || 1;\r\n\t\tthis.dom.onkeydown = (e) => {\r\n\r\n\t\t\te.stopPropagation();\r\n\t\t};\r\n\t\tthis.value = value || 0;\r\n\t\tthis.min = min || -Infinity;\r\n\t\tthis.max = max || +Infinity;\r\n\t\tthis.precision = precision || 0;\r\n\t\tthis.setValue(value);\r\n\t\tthis.dom.onchange = (e) => {\r\n\r\n\t\t\tthis.setValue(this.value);\r\n\t\t};\r\n\t}\r\n\r\n\tgetName() {\r\n\r\n\t\treturn this.dom.name;\r\n\t}\r\n\r\n\tsetName(name) {\r\n\r\n\t\tthis.dom.name = name;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetPrecision(precision) {\r\n\r\n\t\tthis.precision = precision;\r\n\t\tthis.setValue(this.value);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetRange(min, max) {\r\n\r\n\t\tthis.min = min;\r\n\t\tthis.max = max;\r\n\t\tthis.dom.min = min;\r\n\t\tthis.dom.max = max;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetStep(step) {\r\n\r\n\t\tthis.dom.step = step;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetValue() {\r\n\r\n\t\treturn parseFloat(this.dom.value);\r\n\t}\r\n\r\n\tsetValue(value) {\r\n\r\n\t\tif (value !== undefined) {\r\n\t\t\tvalue = parseFloat(value);\r\n\r\n\t\t\tif (value < this.min)\r\n\t\t\t\tvalue = this.min;\r\n\t\t\tif (value > this.max)\r\n\t\t\t\tvalue = this.max;\r\n\r\n\t\t\tthis.value = value;\r\n\t\t\tthis.dom.value = value.toFixed(this.precision);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UIBreak\r\n */\r\nexport class UIBreak extends UIElement {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper(\"br\");\r\n\t}\r\n}\r\n\r\n/**\r\n * UIHorizontalRule\r\n */\r\nexport class UIHorizontalRule extends UIElement {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper(\"hr\");\r\n\t}\r\n}\r\n\r\n/**\r\n * UIProgress\r\n * @param {*} value\r\n */\r\nexport class UIProgress extends UIElement {\r\n\r\n\tconstructor(value) {\r\n\r\n\t\tsuper(\"progress\");\r\n\r\n\t\tthis.dom.value = value;\r\n\t}\r\n\r\n\tsetValue(value) {\r\n\r\n\t\tthis.dom.value = value;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UITabbedPanel\r\n * @param {string} align (horizontal | vertical)\r\n */\r\nexport class UITabbedPanel extends UIDiv {\r\n\r\n\tconstructor(align) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.align = align || \"horizontal\";\r\n\t\tthis.tabs = [];\r\n\t\tthis.panels = [];\r\n\t\tthis.selector = new UISpan().setClass(\"tab-selector\");\r\n\t\tthis.menuDiv = new UIDiv().setClass(\"menu\");\r\n\t\tthis.tabsDiv = new UIDiv().setClass(\"tabs\");\r\n\t\tthis.tabsDiv.add(this.selector);\r\n\t\tthis.panelsDiv = new UIDiv().setClass(\"panels\");\r\n\t\tthis.selected = \"\";\r\n\t\tthis.add(this.menuDiv);\r\n\t\tthis.add(this.tabsDiv);\r\n\t\tthis.add(this.panelsDiv);\r\n\t}\r\n\r\n\taddMenu(items) {\r\n\t\tthis.menuDiv.add(items);\r\n\t}\r\n\r\n\taddTab(id, label, items) {\r\n\r\n\t\tconst tab = new UITab(label, this);\r\n\t\ttab.setId(id);\r\n\t\ttab.setClass(\"box\");\r\n\t\tthis.tabs.push(tab);\r\n\t\tthis.tabsDiv.add(tab);\r\n\r\n\t\tconst panel = new UIDiv();\r\n\t\tpanel.setId(id);\r\n\t\tpanel.add(items);\r\n\t\tthis.panels.push(panel);\r\n\t\tthis.panelsDiv.add(panel);\r\n\t\tthis.select(id);\r\n\t}\r\n\r\n\tselect(id) {\r\n\r\n\t\tfor (let tab of this.tabs) {\r\n\t\t\tif (tab.dom.id === id) {\r\n\t\t\t\ttab.addClass(\"selected\");\r\n\t\t\t\tthis.transformSelector(tab);\r\n\t\t\t} else if (tab.dom.id === this.selected) {\r\n\t\t\t\ttab.removeClass(\"selected\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let panel of this.panels) {\r\n\t\t\tif (panel.dom.id === id) {\r\n\t\t\t\tpanel.dom.style.display = \"block\";\r\n\t\t\t} else if (panel.dom.id === this.selected) {\r\n\t\t\t\tpanel.dom.style.display = \"none\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.selected = id;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetLabel(id, text) {\r\n\r\n\t\tfor (let tab of this.tabs) {\r\n\t\t\tif (tab.dom.id === id) {\r\n\t\t\t\ttab.setTitle(text);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttransformSelector(tab) {\r\n\r\n\t\tlet size;\r\n\t\tconst rect = tab.getBoundingClientRect();\r\n\t\tif (this.align === \"horizontal\") {\r\n\t\t\tsize = rect.width * this.tabs.indexOf(tab);\r\n\t\t\tthis.selector.dom.style.transform = `translateX(${size}px)`;\r\n\t\t} else {\r\n\t\t\tsize = rect.height * this.tabs.indexOf(tab);\r\n\t\t\tthis.selector.dom.style.transform = `translateY(${size}px)`;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * UITab\r\n * @param {string} text\r\n * @param {UITabbedPanel} parent\r\n */\r\nexport class UITab extends UIDiv {\r\n\r\n\tconstructor(text, parent) {\r\n\r\n\t\tsuper();\r\n\t\tthis.button = new UIInput(\"button\");\r\n\t\tthis.button.dom.title = text;\r\n\t\tthis.dom.onclick = (e) => {\r\n\r\n\t\t\tparent.select(this.dom.id);\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\t\tthis.add(this.button);\r\n\t}\r\n}\r\n\r\n/**\r\n * UIList\r\n * @param {UIItem} parent\r\n */\r\nexport class UIList extends UIElement {\r\n\r\n\tconstructor(parent) {\r\n\r\n\t\tsuper(\"ul\");\r\n\t\tthis.parent = parent && parent.parent; // LI->UL\r\n\t\tthis.expanded = false;\r\n\t}\r\n\r\n\texpand() {\r\n\r\n\t\tthis.expanded = true;\r\n\t\tthis.dom.style.display = \"block\";\r\n\t\tif (this.parent)\r\n\t\t\tthis.parent.expand();\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcollaps() {\r\n\r\n\t\tthis.expanded = false;\r\n\t\tthis.dom.style.display = \"none\";\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UIItem\r\n * @param {UIList} parent\r\n */\r\nexport class UIItem extends UIElement {\r\n\r\n\tconstructor(parent) {\r\n\r\n\t\tsuper(\"li\");\r\n\t\tthis.parent = parent; // UL\r\n\t\tthis.selected = false;\r\n\t}\r\n\r\n\tadd() {\r\n\t\tlet len = 0;\r\n\t\tconst box = new UIDiv().setId(\"item-box\");\r\n\t\tfor (let i = 0; i < arguments.length; i++) {\r\n\t\t\tconst argument = arguments[i];\r\n\t\t\tif (argument instanceof UIList) {\r\n\t\t\t\tsuper.add(argument);\r\n\t\t\t} else {\r\n\t\t\t\tbox.add(argument);\r\n\t\t\t\tlen++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (len) super.add(box);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tselect() {\r\n\r\n\t\tthis.selected = true;\r\n\t\tthis.setClass(\"selected\");\r\n\t\treturn this;\r\n\t}\r\n\r\n\tunselect() {\r\n\r\n\t\tthis.selected = false;\r\n\t\tthis.removeAttribute(\"class\");\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * UIBox\r\n * @param {UIElement} items\r\n */\r\nexport class UIBox extends UIElement {\r\n\r\n\tconstructor(items) {\r\n\r\n\t\tsuper(\"div\");\r\n\t\tthis.setClass(\"box\");\r\n\t\tthis.add(items);\r\n\t}\r\n}","import { UIDiv, UIInput } from \"./ui.js\";\r\n\r\nexport class Toolbar {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tconst strings = reader.strings;\r\n\t\tconst settings = reader.settings;\r\n\r\n\t\tconst container = new UIDiv().setId(\"toolbar\");\r\n\t\tconst keys = [\r\n\t\t\t\"toolbar/sidebar\",\r\n\t\t\t\"toolbar/prev\",\r\n\t\t\t\"toolbar/next\",\r\n\t\t\t\"toolbar/openbook\",\r\n\t\t\t\"toolbar/openbook/error\",\r\n\t\t\t\"toolbar/bookmark\",\r\n\t\t\t\"toolbar/fullscreen\"\r\n\t\t];\r\n\t\tconst menu1 = new UIDiv().setClass(\"menu-1\");\r\n\t\tconst openerBox = new UIDiv().setId(\"btn-m\").setClass(\"box\");\r\n\t\tconst openerBtn = new UIInput(\"button\");\r\n\t\topenerBtn.dom.title = strings.get(keys[0]);\r\n\t\topenerBtn.dom.onclick = (e) => {\r\n\r\n\t\t\treader.emit(\"sidebaropener\", true);\r\n\t\t\topenerBtn.dom.blur();\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\t\topenerBox.add(openerBtn);\r\n\t\tmenu1.add(openerBox);\r\n\r\n\t\tlet prevBox, prevBtn;\r\n\t\tlet nextBox, nextBtn;\r\n\t\tif (settings.arrows === \"toolbar\") {\r\n\t\t\tprevBox = new UIDiv().setId(\"btn-p\").setClass(\"box\");\r\n\t\t\tprevBtn = new UIInput(\"button\");\r\n\t\t\tprevBtn.setTitle(strings.get(keys[1]));\r\n\t\t\tprevBtn.dom.onclick = (e) => {\r\n\r\n\t\t\t\treader.emit(\"prev\");\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tprevBtn.dom.blur();\r\n\t\t\t};\r\n\t\t\tprevBox.add(prevBtn);\r\n\t\t\tmenu1.add(prevBox);\r\n\r\n\t\t\tnextBox = new UIDiv().setId(\"btn-n\").setClass(\"box\");\r\n\t\t\tnextBtn = new UIInput(\"button\");\r\n\t\t\tnextBtn.dom.title = strings.get(keys[2]);\r\n\t\t\tnextBtn.dom.onclick = (e) => {\r\n\r\n\t\t\t\treader.emit(\"next\");\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tnextBtn.dom.blur();\r\n\t\t\t};\r\n\t\t\tnextBox.add(nextBtn);\r\n\t\t\tmenu1.add(nextBox);\r\n\t\t}\r\n\r\n\t\tconst menu2 = new UIDiv().setClass(\"menu-2\");\r\n\t\tlet openbookBtn;\r\n\t\tif (settings.openbook) {\r\n\t\t\tconst onload = (e) => {\r\n\r\n\t\t\t\treader.storage.clear();\r\n\t\t\t\treader.storage.set(e.target.result, () => {\r\n\t\t\t\t\treader.unload();\r\n\t\t\t\t\treader.init(e.target.result);\r\n\t\t\t\t\tconst url = new URL(window.location.origin);\r\n\t\t\t\t\twindow.history.pushState({}, \"\", url);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tconst onerror = (e) => {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t};\r\n\t\t\tconst openbookBox = new UIDiv().setId(\"btn-o\").setClass(\"box\");\r\n\t\t\topenbookBtn = new UIInput(\"file\");\r\n\t\t\topenbookBtn.dom.title = strings.get(keys[3]);\r\n\t\t\topenbookBtn.dom.accept = \"application/epub+zip\";\r\n\t\t\topenbookBtn.dom.onchange = (e) => {\r\n\r\n\t\t\t\tif (e.target.files.length === 0)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (window.FileReader) {\r\n\r\n\t\t\t\t\tconst fr = new FileReader();\r\n\t\t\t\t\tfr.onload = onload;\r\n\t\t\t\t\tfr.readAsArrayBuffer(e.target.files[0]);\r\n\t\t\t\t\tfr.onerror = onerror;\r\n\t\t\t\t} else {\r\n\t\t\t\t\talert(strings.get(keys[4]));\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\t\t\topenbookBtn.dom.onclick = (e) => {\r\n\r\n\t\t\t\topenbookBtn.dom.blur();\r\n\t\t\t};\r\n\t\t\topenbookBox.add(openbookBtn);\r\n\t\t\tmenu2.add(openbookBox);\r\n\t\t}\r\n\r\n\t\tlet bookmarkBox, bookmarkBtn;\r\n\t\tif (settings.bookmarks) {\r\n\t\t\tbookmarkBox = new UIDiv().setId(\"btn-b\").setClass(\"box\");\r\n\t\t\tbookmarkBtn = new UIInput(\"button\");\r\n\t\t\tbookmarkBtn.setTitle(strings.get(keys[5]));\r\n\t\t\tbookmarkBtn.dom.onclick = (e) => {\r\n\r\n\t\t\t\tconst cfi = this.locationCfi;\r\n\t\t\t\tconst val = reader.isBookmarked(cfi) === -1;\r\n\t\t\t\treader.emit(\"bookmarked\", val);\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tbookmarkBtn.dom.blur();\r\n\t\t\t};\r\n\t\t\tbookmarkBox.add(bookmarkBtn);\r\n\t\t\tmenu2.add(bookmarkBox);\r\n\t\t}\r\n\r\n\t\tlet fullscreenBtn;\r\n\t\tif (settings.fullscreen) {\r\n\r\n\t\t\tconst fullscreenBox = new UIDiv().setId(\"btn-f\").setClass(\"box\");\r\n\t\t\tfullscreenBtn = new UIInput(\"button\");\r\n\t\t\tfullscreenBtn.setTitle(strings.get(keys[6]));\r\n\t\t\tfullscreenBtn.dom.onclick = (e) => {\r\n\r\n\t\t\t\tthis.toggleFullScreen();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t};\r\n\r\n\t\t\tdocument.onkeydown = (e) => {\r\n\r\n\t\t\t\tif (e.key === \"F11\") {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tthis.toggleFullScreen();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tdocument.onfullscreenchange = (e) => {\r\n\r\n\t\t\t\tconst w = window.screen.width === e.target.clientWidth;\r\n\t\t\t\tconst h = window.screen.height === e.target.clientHeight;\r\n\r\n\t\t\t\tif (w && h) {\r\n\t\t\t\t\tfullscreenBox.addClass(\"resize-small\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfullscreenBox.removeClass(\"resize-small\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tfullscreenBox.add(fullscreenBtn);\r\n\t\t\tmenu2.add(fullscreenBox);\r\n\t\t}\r\n\r\n\t\tcontainer.add([menu1, menu2]);\r\n\t\tdocument.body.appendChild(container.dom);\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"relocated\", (location) => {\r\n\r\n\t\t\tif (settings.bookmarks) {\r\n\t\t\t\tconst cfi = location.start.cfi;\r\n\t\t\t\tconst val = reader.isBookmarked(cfi) === -1;\r\n\t\t\t\tif (val) {\r\n\t\t\t\t\tbookmarkBox.removeClass(\"bookmarked\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbookmarkBox.addClass(\"bookmarked\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.locationCfi = cfi; // save location cfi\r\n\t\t\t}\r\n\t\t\tif (settings.arrows === \"toolbar\") {\r\n\t\t\t\tprevBox.dom.style.display = location.atStart ? \"none\" : \"block\";\r\n\t\t\t\tnextBox.dom.style.display = location.atEnd ? \"none\" : \"block\";\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"bookmarked\", (boolean) => {\r\n\r\n\t\t\tif (boolean) {\r\n\t\t\t\tbookmarkBox.addClass(\"bookmarked\");\r\n\t\t\t} else {\r\n\t\t\t\tbookmarkBox.removeClass(\"bookmarked\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\r\n\t\t\topenerBtn.setTitle(strings.get(keys[0]));\r\n\r\n\t\t\tif (settings.arrows === \"toolbar\") {\r\n\t\t\t\tprevBtn.setTitle(strings.get(keys[1]));\r\n\t\t\t\tnextBtn.setTitle(strings.get(keys[2]));\r\n\t\t\t}\r\n\t\t\tif (settings.openbook) {\r\n\t\t\t\topenbookBtn.setTitle(strings.get(keys[3]));\r\n\t\t\t}\r\n\t\t\tif (settings.bookmarks) {\r\n\t\t\t\tbookmarkBtn.setTitle(strings.get(keys[5]));\r\n\t\t\t}\r\n\t\t\tif (settings.fullscreen) {\r\n\t\t\t\tfullscreenBtn.setTitle(strings.get(keys[6]));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\ttoggleFullScreen() {\r\n\r\n\t\tdocument.activeElement.blur();\r\n\r\n\t\tif (document.fullscreenElement === null) {\r\n\t\t\tdocument.documentElement.requestFullscreen();\r\n\t\t} else if (document.exitFullscreen) {\r\n\t\t\tdocument.exitFullscreen();\r\n\t\t}\r\n\t}\r\n}","import { UIDiv, UISpan } from \"./ui.js\";\r\n\r\nexport class Content {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tconst settings = reader.settings;\r\n\t\tconst container = new UIDiv().setId(\"content\");\r\n\r\n\t\tlet prev;\r\n\t\tif (settings.arrows === \"content\") {\r\n\r\n\t\t\tprev = new UIDiv().setId(\"prev\").setClass(\"arrow\");\r\n\t\t\tprev.dom.onclick = (e) => {\r\n\r\n\t\t\t\treader.emit(\"prev\");\r\n\t\t\t\te.preventDefault();\r\n\t\t\t};\r\n\t\t\tprev.add(new UISpan(\"<\"));\r\n\t\t\tcontainer.add(prev);\r\n\t\t}\r\n\r\n\t\tconst viewer = new UIDiv().setId(\"viewer\");\r\n\t\tcontainer.add(viewer);\r\n\r\n\t\tlet next;\r\n\t\tif (settings.arrows === \"content\") {\r\n\t\t\tnext = new UIDiv().setId(\"next\").setClass(\"arrow\");\r\n\t\t\tnext.dom.onclick = (e) => {\r\n\r\n\t\t\t\treader.emit(\"next\");\r\n\t\t\t\te.preventDefault();\r\n\t\t\t};\r\n\t\t\tnext.add(new UISpan(\">\"));\r\n\t\t\tcontainer.add(next);\r\n\t\t}\r\n\r\n\t\tconst loader = new UIDiv().setId(\"loader\");\r\n\t\tconst divider = new UIDiv().setId(\"divider\");\r\n\t\tconst overlay = new UIDiv().setId(\"overlay\");\r\n\t\toverlay.dom.onclick = (e) => {\r\n\t\t\treader.emit(\"sidebaropener\", false);\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\r\n\t\tcontainer.add([loader, divider, overlay]);\r\n\t\tdocument.body.appendChild(container.dom);\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"bookready\", (cfg) => {\r\n\r\n\t\t\tviewer.setClass(cfg.flow);\r\n\t\t\tloader.dom.style.display = \"block\";\r\n\t\t});\r\n\r\n\t\treader.on(\"bookloaded\", () => {\r\n\r\n\t\t\tloader.dom.style.display = \"none\";\r\n\t\t});\r\n\r\n\t\treader.on(\"layout\", (props) => {\r\n\r\n\t\t\tif (props.spread && props.width > props.spreadWidth) {\r\n\t\t\t\tdivider.dom.style.display = \"block\";\r\n\t\t\t} else {\r\n\t\t\t\tdivider.dom.style.display = \"none\";\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"flowchanged\", (value) => {\r\n\t\t\t\r\n\t\t\tviewer.setClass(value);\r\n\t\t});\r\n\r\n\t\treader.on(\"relocated\", (location) => {\r\n\r\n\t\t\tif (settings.arrows === \"content\") {\r\n\t\t\t\tif (location.atStart) {\r\n\t\t\t\t\tprev.addClass(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprev.removeClass(\"disabled\");\r\n\t\t\t\t}\r\n\t\t\t\tif (location.atEnd) {\r\n\t\t\t\t\tnext.addClass(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext.removeClass(\"disabled\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"prev\", () => {\r\n\r\n\t\t\tif (settings.arrows === \"content\") {\r\n\t\t\t\tprev.addClass(\"active\");\r\n\t\t\t\tsetTimeout(() => { prev.removeClass(\"active\"); }, 100);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"next\", () => {\r\n\r\n\t\t\tif (settings.arrows === \"content\") {\r\n\t\t\t\tnext.addClass(\"active\");\r\n\t\t\t\tsetTimeout(() => { next.removeClass(\"active\"); }, 100);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"sidebaropener\", (value) => {\r\n\r\n\t\t\toverlay.dom.style.display = value ? \"block\" : \"none\";\r\n\t\t});\r\n\r\n\t\treader.on(\"viewercleanup\", () => {\r\n\r\n\t\t\tviewer.clear();\r\n\t\t});\r\n\t}\r\n}","import { UIPanel, UIDiv, UIItem, UIList, UILink, UISpan, UIText, UIBox } from \"../ui.js\";\r\n\r\nexport class TocPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tsuper();\r\n\t\tconst container = new UIDiv().setClass(\"list-container\");\r\n\t\tconst strings = reader.strings;\r\n\t\tconst keys = [\r\n\t\t\t\"sidebar/contents\"\r\n\t\t];\r\n\t\tconst label = new UIText(strings.get(keys[0])).setClass(\"label\");\r\n\t\tthis.reader = reader;\r\n\t\tthis.selector = undefined; // save reference to selected tree item\r\n\t\tthis.setId(\"contents\");\r\n\t\tthis.add(new UIBox(label).addClass(\"header\"));\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"navigation\", (toc) => {\r\n\r\n\t\t\tcontainer.clear();\r\n\t\t\tcontainer.add(this.generateToc(toc));\r\n\t\t\tthis.add(container);\r\n\t\t});\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\r\n\t\t\tlabel.setValue(strings.get(keys[0]));\r\n\t\t});\r\n\t}\r\n\r\n\tgenerateToc(toc, parent) {\r\n\r\n\t\tconst list = new UIList(parent);\r\n\r\n\t\ttoc.forEach((chapter) => {\r\n\r\n\t\t\tconst link = new UILink(chapter.href, chapter.label);\r\n\t\t\tconst item = new UIItem(list).setId(chapter.id);\r\n\t\t\tconst ibtn = new UISpan();\r\n\r\n\t\t\tlink.dom.onclick = (e) => {\r\n\r\n\t\t\t\tif (this.selector && this.selector !== item)\r\n\t\t\t\t\tthis.selector.unselect();\r\n\r\n\t\t\t\titem.select();\r\n\t\t\t\tthis.selector = item;\r\n\t\t\t\tthis.reader.settings.sectionId = chapter.id;\r\n\t\t\t\tthis.reader.rendition.display(chapter.href);\r\n\t\t\t\te.preventDefault();\r\n\t\t\t};\r\n\t\t\titem.add([ibtn, link]);\r\n\t\t\tthis.reader.navItems[chapter.href] = {\r\n\t\t\t\tid: chapter.id,\r\n\t\t\t\tlabel: chapter.label\r\n\t\t\t};\r\n\r\n\t\t\tif (this.reader.settings.sectionId === chapter.id) {\r\n\t\t\t\tlist.expand();\r\n\t\t\t\titem.select();\r\n\t\t\t\tthis.selector = item;\r\n\t\t\t}\r\n\r\n\t\t\tif (chapter.subitems && chapter.subitems.length > 0) {\r\n\r\n\t\t\t\tconst subItems = this.generateToc(chapter.subitems, item);\r\n\t\t\t\tibtn.setClass(\"toggle-collapsed\");\r\n\t\t\t\tibtn.dom.onclick = () => {\r\n\r\n\t\t\t\t\tif (subItems.expanded) {\r\n\t\t\t\t\t\tsubItems.collaps();\r\n\t\t\t\t\t\tibtn.setClass(\"toggle-collapsed\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsubItems.expand();\r\n\t\t\t\t\t\tibtn.setClass(\"toggle-expanded\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t\titem.add(subItems);\r\n\t\t\t}\r\n\r\n\t\t\tlist.add(item);\r\n\t\t});\r\n\r\n\t\treturn list;\r\n\t}\r\n}","import { UIPanel, UIDiv, UIRow, UIInput, UILink, UIList, UIItem, UIText, UIBox, UISpan } from \"../ui.js\";\r\n\r\nexport class BookmarksPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tsuper();\r\n\t\tconst container = new UIDiv().setClass(\"list-container\");\r\n\t\tconst strings = reader.strings;\r\n\t\tconst keys = [\r\n\t\t\t\"sidebar/bookmarks\",\r\n\t\t\t\"sidebar/bookmarks/clear\"\r\n\t\t];\r\n\t\tconst headerLabel = new UIText(strings.get(keys[0])).setClass(\"label\");\r\n\t\tconst clearBtn = new UIInput(\"button\", strings.get(keys[1]));\r\n\t\tclearBtn.dom.onclick = (e) => {\r\n\r\n\t\t\tthis.clearBookmarks();\r\n\t\t\treader.emit(\"bookmarked\", false);\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\t\tthis.add(new UIBox([headerLabel, clearBtn]).addClass(\"header\"));\r\n\t\tthis.selector = undefined;\r\n\t\tthis.bookmarks = new UIList();\r\n\t\tcontainer.add(this.bookmarks);\r\n\t\tthis.setId(\"bookmarks\");\r\n\t\tthis.add(container);\r\n\t\tthis.reader = reader;\r\n\r\n\t\tconst update = () => {\r\n\r\n\t\t\tclearBtn.dom.disabled = reader.settings.bookmarks.length === 0;\r\n\t\t};\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"displayed\", (renderer, cfg) => {\r\n\r\n\t\t\tcfg.bookmarks.forEach((cfi) => {\r\n\r\n\t\t\t\tthis.setBookmark(cfi);\r\n\t\t\t});\r\n\t\t\tupdate();\r\n\t\t});\r\n\r\n\t\treader.on(\"relocated\", (location) => {\r\n\r\n\t\t\tthis.locationCfi = location.start.cfi; // save location cfi\r\n\t\t});\r\n\r\n\t\treader.on(\"bookmarked\", (boolean, cfi) => {\r\n\r\n\t\t\tif (boolean) {\r\n\t\t\t\tthis.appendBookmark();\r\n\t\t\t} else {\r\n\t\t\t\tthis.removeBookmark(cfi);\r\n\t\t\t}\r\n\t\t\tupdate();\r\n\t\t});\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\r\n\t\t\theaderLabel.setValue(strings.get(keys[0]));\r\n\t\t\tclearBtn.setValue(strings.get(keys[1]));\r\n\t\t});\r\n\t}\r\n\r\n\tappendBookmark() {\r\n\r\n\t\tconst cfi = this.locationCfi;\r\n\t\tif (this.reader.isBookmarked(cfi) > -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setBookmark(cfi);\r\n\t\tthis.reader.settings.bookmarks.push(cfi);\r\n\t}\r\n\r\n\tremoveBookmark(cfi) {\r\n\r\n\t\tconst _cfi = cfi || this.locationCfi;\r\n\t\tconst index = this.reader.isBookmarked(_cfi);\r\n\t\tif (index === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.bookmarks.remove(index);\r\n\t\tthis.reader.settings.bookmarks.splice(index, 1);\r\n\t}\r\n\r\n\tclearBookmarks() {\r\n\r\n\t\tthis.bookmarks.clear();\r\n\t\tthis.reader.settings.bookmarks = [];\r\n\t}\r\n\r\n\tsetBookmark(cfi) {\r\n\r\n\t\tconst link = new UILink();\r\n\t\tconst item = new UIItem();\r\n\t\tconst btnr = new UISpan().setClass(\"btn-remove\");\r\n\t\tconst navItem = this.reader.navItemFromCfi(cfi);\r\n\t\tlet idref;\r\n\t\tlet label;\r\n\r\n\t\tif (navItem === undefined) {\r\n\t\t\tconst spineItem = this.reader.book.spine.get(cfi);\r\n\t\t\tidref = spineItem.idref;\r\n\t\t\tlabel = spineItem.idref\r\n\t\t} else {\r\n\t\t\tidref = navItem.id;\r\n\t\t\tlabel = navItem.label;\r\n\t\t}\r\n\r\n\t\tlink.setHref(\"#\" + cfi);\r\n\t\tlink.dom.onclick = (e) => {\r\n\r\n\t\t\tif (this.selector && this.selector !== item) {\r\n\t\t\t\tthis.selector.unselect();\r\n\t\t\t}\r\n\t\t\titem.select();\r\n\t\t\tthis.selector = item;\r\n\t\t\tthis.reader.rendition.display(cfi);\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\t\tlink.setTextContent(label);\r\n\r\n\t\tbtnr.dom.onclick = (e) => {\r\n\r\n\t\t\tthis.reader.emit(\"bookmarked\", false, cfi);\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\r\n\t\titem.add([link, btnr]);\r\n\t\titem.setId(idref);\r\n\t\tthis.bookmarks.add(item);\r\n\t}\r\n}","import { UIPanel, UIDiv, UITextArea, UIInput, UILink, UIList, UIItem, UISpan, UIText, UIBox } from \"../ui.js\";\r\n\r\nexport class AnnotationsPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tsuper();\r\n\t\tconst container = new UIDiv().setClass(\"list-container\");\r\n\t\tconst strings = reader.strings;\r\n\t\tconst keys = [\r\n\t\t\t\"sidebar/annotations\",\r\n\t\t\t\"sidebar/annotations/clear\"\r\n\t\t];\r\n\t\tconst headerLabel = new UIText(strings.get(keys[0])).setClass(\"label\");\r\n\t\tconst clearBtn = new UIInput(\"button\", strings.get(keys[1]));\r\n\t\tclearBtn.dom.onclick = (e) => {\r\n\r\n\t\t\tthis.clearNotes();\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\t\tthis.add(new UIBox([headerLabel, clearBtn]).addClass(\"header\"));\r\n\t\tthis.selector = undefined;\r\n\t\tthis.notes = new UIList();\r\n\t\tcontainer.add(this.notes);\r\n\t\tthis.setId(\"annotations\");\r\n\t\tthis.add(container);\r\n\t\tthis.reader = reader;\r\n\t\tthis.update = () => {\r\n\r\n\t\t\tclearBtn.dom.disabled = reader.settings.annotations.length === 0;\r\n\t\t};\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"bookready\", (cfg) => {\r\n\r\n\t\t\tcfg.annotations.forEach((note) => {\r\n\r\n\t\t\t\tthis.set(note);\r\n\t\t\t});\r\n\t\t\tthis.update();\r\n\t\t});\r\n\r\n\t\treader.on(\"noteadded\", (note) => {\r\n\r\n\t\t\tthis.set(note);\r\n\t\t\tthis.update();\r\n\t\t});\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\r\n\t\t\theaderLabel.setValue(strings.get(keys[0]));\r\n\t\t\tclearBtn.setValue(strings.get(keys[1]));\r\n\t\t});\r\n\t}\r\n\r\n\tset(note) {\r\n\r\n\t\tconst link = new UILink(\"#\" + note.cfi, note.text);\r\n\t\tconst item = new UIItem().setId(\"note-\" + note.uuid);\r\n\t\tconst btnr = new UISpan().setClass(\"btn-remove\");\r\n\t\tconst call = () => { };\r\n\r\n\t\tlink.dom.onclick = (e) => {\r\n\r\n\t\t\tif (this.selector && this.selector !== item) {\r\n\t\t\t\tthis.selector.unselect();\r\n\t\t\t}\r\n\t\t\titem.select();\r\n\t\t\tthis.selector = item;\r\n\t\t\tthis.reader.rendition.display(note.cfi);\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\r\n\t\tbtnr.dom.onclick = (e) => {\r\n\r\n\t\t\tthis.removeNote(note);\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\r\n\t\titem.add([link, btnr]);\r\n\t\tthis.notes.add(item);\r\n\t\tthis.reader.rendition.annotations.add(\r\n\t\t\t\"highlight\", note.cfi, {}, call, \"note-highlight\", {});\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tremoveNote(note) {\r\n\r\n\t\tconst index = this.reader.settings.annotations.indexOf(note);\r\n\t\tif (index === -1)\r\n\t\t\treturn;\r\n\r\n\t\tthis.notes.remove(index);\r\n\t\tthis.reader.settings.annotations.splice(index, 1);\r\n\t\tthis.reader.rendition.annotations.remove(note.cfi, \"highlight\");\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tclearNotes() {\r\n\r\n\t\tthis.reader.settings.annotations.forEach(note => {\r\n\t\t\tthis.reader.rendition.annotations.remove(note.cfi, \"highlight\");\r\n\t\t});\r\n\t\tthis.notes.clear();\r\n\t\tthis.reader.settings.annotations = [];\r\n\t\tthis.update();\r\n\t}\r\n}","import { UIPanel, UIDiv, UIInput, UILink, UIList, UIItem, UIBox } from \"../ui.js\";\r\n\r\nexport class SearchPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tsuper();\r\n\t\tconst container = new UIDiv().setClass(\"list-container\");\r\n\t\tconst strings = reader.strings;\r\n\r\n\t\tlet searchQuery = undefined;\r\n\t\tconst search = new UIInput(\"search\").setId(\"nav-q\");\r\n\t\tsearch.dom.placeholder = strings.get(\"sidebar/search/placeholder\");\r\n\t\tsearch.dom.onsearch = () => {\r\n\r\n\t\t\tconst value = search.getValue();\r\n\r\n\t\t\tif (value.length === 0) {\r\n\t\t\t\tthis.items.clear();\r\n\t\t\t} else if (searchQuery !== value) {\r\n\t\t\t\tthis.items.clear();\r\n\t\t\t\tthis.doSearch(value).then(results => {\r\n\r\n\t\t\t\t\tresults.forEach(data => {\r\n\t\t\t\t\t\tthis.set(data);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tsearchQuery = value;\r\n\t\t};\r\n\r\n\t\tthis.setId(\"search\");\r\n\t\tthis.items = new UIList();\r\n\t\tcontainer.add(this.items);\r\n\t\tthis.add([new UIBox(search), container]);\r\n\t\tthis.reader = reader;\r\n\t\tthis.selector = undefined;\r\n\t\t//\r\n\t\t// improvement of the highlighting of keywords is required...\r\n\t\t//\r\n\t}\r\n\r\n\t/**\r\n\t * Searching the entire book\r\n\t * @param {*} q Query keyword\r\n\t * @returns The search result array.\r\n\t */\r\n\tasync doSearch(q) {\r\n\r\n\t\tconst book = this.reader.book;\r\n\t\tconst results = await Promise.all(\r\n\t\t\tbook.spine.spineItems.map(item => item.load(book.load.bind(book))\r\n\t\t\t\t.then(item.find.bind(item, q)).finally(item.unload.bind(item))));\r\n\t\treturn await Promise.resolve([].concat.apply([], results));\r\n\t}\r\n\r\n\tset(data) {\r\n\r\n\t\tconst link = new UILink(\"#\" + data.cfi, data.excerpt);\r\n\t\tconst item = new UIItem();\r\n\t\tlink.dom.onclick = () => {\r\n\r\n\t\t\tif (this.selector && this.selector !== item)\r\n\t\t\t\tthis.selector.unselect();\r\n\t\t\t\r\n\t\t\titem.select();\r\n\t\t\tthis.selector = item;\r\n\t\t\tthis.reader.rendition.display(data.cfi);\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\titem.add(link);\r\n\t\tthis.items.add(item);\r\n\t}\r\n}","import { UIPanel, UIRow, UISelect, UIInput, UILabel, UINumber, UIText, UIBox, UIDiv } from \"../ui.js\";\r\n\r\nexport class SettingsPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tsuper();\r\n\t\tsuper.setId(\"settings\");\r\n\r\n\t\tconst strings = reader.strings;\r\n\t\tconst keys = [\r\n\t\t\t\"sidebar/settings\",\r\n\t\t\t\"sidebar/settings/language\",\r\n\t\t\t\"sidebar/settings/fontsize\",\r\n\t\t\t\"sidebar/settings/flow\",\r\n\t\t\t\"sidebar/settings/spread\",\r\n\t\t\t\"sidebar/settings/spread/minwidth\"\r\n\t\t];\r\n\t\tconst headerLabel = new UIText(strings.get(keys[0])).setClass(\"label\");\r\n\t\tthis.add(new UIBox(headerLabel).addClass(\"header\"));\r\n\r\n\t\tconst languageLabel = new UILabel(strings.get(keys[1]), \"language-ui\");\r\n\t\tconst languageRow = new UIRow();\r\n\t\tconst language = new UISelect().setOptions({\r\n\t\t\ten: \"English\",\r\n\t\t\tfr: \"French\",\r\n\t\t\tja: \"Japanese\",\r\n\t\t\tru: \"Russian\"\r\n\t\t});\r\n\t\tlanguage.dom.onchange = (e) => {\r\n\r\n\t\t\treader.emit(\"languagechanged\", e.target.value);\r\n\t\t};\r\n\t\tlanguage.setId(\"language-ui\");\r\n\t\tlanguageRow.add(languageLabel);\r\n\t\tlanguageRow.add(language);\r\n\r\n\t\tconst fontSizeLabel = new UILabel(strings.get(keys[2]), \"fontsize\");\r\n\t\tconst fontSizeRow = new UIRow();\r\n\t\tconst fontSize = new UINumber(100, 1);\r\n\t\tfontSize.dom.onchange = (e) => {\r\n\r\n\t\t\treader.emit(\"styleschanged\", {\r\n\t\t\t\tfontSize: parseInt(e.target.value)\r\n\t\t\t});\r\n\t\t};\r\n\t\tfontSize.setId(\"fontsize\")\r\n\t\tfontSizeRow.add(fontSizeLabel);\r\n\t\tfontSizeRow.add(fontSize);\r\n\r\n\t\t//-- flow configure --//\r\n\r\n\t\tconst flowLabel = new UILabel(strings.get(keys[3]), \"flow\");\r\n\t\tconst flowRow = new UIRow();\r\n\t\tconst flow = new UISelect().setOptions({\r\n\t\t\tpaginated: \"Paginated\",\r\n\t\t\tscrolled: \"Scrolled\"\r\n\t\t});\r\n\t\tflow.dom.onchange = (e) => {\r\n\r\n\t\t\treader.emit(\"flowchanged\", e.target.value);\r\n\r\n\t\t\tif (e.target.value === \"scrolled\") {\r\n\t\t\t\treader.emit(\"spreadchanged\", {\r\n\t\t\t\t\tmod: \"none\",\r\n\t\t\t\t\tmin: undefined\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treader.emit(\"spreadchanged\", {\r\n\t\t\t\t\tmod: undefined,\r\n\t\t\t\t\tmin: undefined\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\tflow.setId(\"flow\");\r\n\t\tflowRow.add(flowLabel);\r\n\t\tflowRow.add(flow);\r\n\r\n\t\t//-- spdead configure --//\r\n\r\n\t\tconst minSpreadWidth = new UINumber(800, 1);\r\n\t\tconst spreadLabel = new UILabel(strings.get(keys[4]), \"spread\");\r\n\t\tconst spreadRow = new UIRow();\r\n\t\tconst spread = new UISelect().setOptions({\r\n\t\t\tnone: \"None\",\r\n\t\t\tauto: \"Auto\"\r\n\t\t});\r\n\t\tspread.dom.onchange = (e) => {\r\n\r\n\t\t\treader.emit(\"spreadchanged\", {\r\n\t\t\t\tmod: e.target.value,\r\n\t\t\t\tmin: undefined\r\n\t\t\t});\r\n\t\t\tminSpreadWidth.dom.disabled = e.target.value === \"none\";\r\n\t\t};\r\n\t\tspread.setId(\"spread\");\r\n\r\n\t\tspreadRow.add(spreadLabel);\r\n\t\tspreadRow.add(spread);\r\n\r\n\t\tconst minSpreadWidthLabel = new UILabel(strings.get(keys[5]), \"min-spread-width\");\r\n\t\tconst minSpreadWidthRow = new UIRow();\r\n\t\tminSpreadWidth.dom.onchange = (e) => {\r\n\r\n\t\t\treader.emit(\"spreadchanged\", {\r\n\t\t\t\tmod: undefined,\r\n\t\t\t\tmin: parseInt(e.target.value)\r\n\t\t\t});\r\n\t\t};\r\n\t\tminSpreadWidth.setId(\"min-spread-width\");\r\n\t\tminSpreadWidthRow.add(minSpreadWidthLabel);\r\n\t\tminSpreadWidthRow.add(minSpreadWidth);\r\n\r\n\t\t//-- pagination --//\r\n\r\n\t\tconst paginationStr = strings.get(\"sidebar/settings/pagination\");\r\n\t\tconst paginationRow = new UIRow();\r\n\t\tconst pagination = new UIInput(\"checkbox\", false, paginationStr[1]);\r\n\t\tpagination.setId(\"pagination\");\r\n\t\tpagination.dom.onclick = (e) => {\r\n\r\n\t\t\t// not implemented\r\n\t\t};\r\n\r\n\t\tpaginationRow.add(new UILabel(paginationStr[0], \"pagination\"));\r\n\t\tpaginationRow.add(pagination);\r\n\r\n\t\tthis.add(new UIBox([\r\n\t\t\tlanguageRow,\r\n\t\t\tfontSizeRow,\r\n\t\t\tflowRow,\r\n\t\t\tspreadRow,\r\n\t\t\tminSpreadWidthRow,\r\n\t\t\t//paginationRow\r\n\t\t]));\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"bookready\", (cfg) => {\r\n\r\n\t\t\tlanguage.setValue(cfg.language);\r\n\t\t\tfontSize.setValue(cfg.styles.fontSize);\r\n\t\t\tflow.setValue(cfg.flow);\r\n\t\t\tspread.setValue(cfg.spread.mod);\r\n\t\t\tminSpreadWidth.setValue(cfg.spread.min);\r\n\t\t\tminSpreadWidth.dom.disabled = cfg.spread.mod === \"none\";\r\n\t\t});\r\n\r\n\t\treader.on(\"layout\", (props) => {\r\n\r\n\t\t\tif (props.flow === \"scrolled\") {\r\n\t\t\t\tspread.setValue(\"none\");\r\n\t\t\t\tspread.dom.disabled = true;\r\n\t\t\t\tminSpreadWidth.dom.disabled = true;\r\n\t\t\t} else {\r\n\t\t\t\tspread.dom.disabled = false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\r\n\t\t\theaderLabel.setTextContent(strings.get(keys[0]));\r\n\t\t\tlanguageLabel.setTextContent(strings.get(keys[1]));\r\n\t\t\tfontSizeLabel.setTextContent(strings.get(keys[2]));\r\n\t\t\tflowLabel.setTextContent(strings.get(keys[3]));\r\n\t\t\tspreadLabel.setTextContent(strings.get(keys[4]));\r\n\t\t\tminSpreadWidthLabel.setTextContent(strings.get(keys[5]));\r\n\t\t});\r\n\t}\r\n}","import { UIBox, UIDiv, UIItem, UIList, UIPanel, UIText } from \"../ui.js\";\r\n\r\nexport class MetadataPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tsuper();\r\n\t\tconst container = new UIDiv().setClass(\"list-container\");\r\n\t\tconst strings = reader.strings;\r\n\t\tconst labels = {};\r\n\t\tconst key = \"sidebar/metadata\";\r\n\t\tconst label = new UIText(strings.get(key)).setClass(\"label\");\r\n\t\tthis.add(new UIBox(label).addClass(\"header\"));\r\n\t\tlabels[key] = label;\r\n\r\n\t\tthis.items = new UIList();\r\n\t\tthis.setId(\"metadata\");\r\n\t\tthis.add(container);\r\n\r\n\t\tconst init = (prop, meta) => {\r\n\t\t\tif (meta[prop] === undefined ||\r\n\t\t\t\tmeta[prop] === null || (typeof meta[prop] === \"string\" && meta[prop].length === 0)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst item = new UIItem();\r\n\t\t\tconst label = new UIText().setClass(\"label\");\r\n\t\t\tconst value = new UIText().setClass(\"value\");\r\n\t\t\tlabel.setValue(strings.get(key + \"/\" + prop).toUpperCase());\r\n\t\t\tif (prop === \"description\") {\r\n\t\t\t\tvalue.dom.innerHTML = meta[prop];\r\n\t\t\t} else {\r\n\t\t\t\tvalue.setValue(meta[prop]);\r\n\t\t\t}\r\n\t\t\tlabels[key + \"/\" + prop] = label;\r\n\t\t\titem.add([label, value]);\r\n\t\t\tthis.items.add(item);\r\n\t\t}\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"metadata\", (meta) => {\r\n\r\n\t\t\tthis.items.clear();\r\n\t\t\tcontainer.clear();\r\n\t\t\tcontainer.add(this.items);\r\n\t\t\tdocument.title = meta.title;\r\n\t\t\tfor (const prop in meta) {\r\n\t\t\t\tinit(prop, meta);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\r\n\t\t\tfor (const prop in labels) {\r\n\t\t\t\tlet text;\r\n\t\t\t\tif (prop === key) {\r\n\t\t\t\t\ttext = strings.get(prop);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext = strings.get(prop).toUpperCase();\r\n\t\t\t\t}\r\n\t\t\t\tlabels[prop].setValue(text);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import { UITabbedPanel, UIInput, UIDiv } from \"./ui.js\";\r\nimport { TocPanel } from \"./sidebar/toc.js\";\r\nimport { BookmarksPanel } from \"./sidebar/bookmarks.js\";\r\nimport { AnnotationsPanel } from \"./sidebar/annotations.js\";\r\nimport { SearchPanel } from \"./sidebar/search.js\";\r\nimport { SettingsPanel } from \"./sidebar/settings.js\";\r\nimport { MetadataPanel } from \"./sidebar/metadata.js\";\r\n\r\nexport class Sidebar {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tconst strings = reader.strings;\r\n\t\tconst controls = reader.settings;\r\n\t\tconst keys = [\r\n\t\t\t\"sidebar/close\",\r\n\t\t\t\"sidebar/contents\",\r\n\t\t\t\"sidebar/bookmarks\",\r\n\t\t\t\"sidebar/annotations\",\r\n\t\t\t\"sidebar/search\",\r\n\t\t\t\"sidebar/settings\",\r\n\t\t\t\"sidebar/metadata\"\r\n\t\t];\r\n\r\n\t\tconst container = new UITabbedPanel(\"vertical\").setId(\"sidebar\");\r\n\r\n\t\tconst openerBox = new UIDiv().setId(\"btn-p\").addClass(\"box\");\r\n\t\tconst openerBtn = new UIInput(\"button\");\r\n\t\topenerBtn.setTitle(strings.get(keys[0]));\r\n\t\topenerBtn.dom.onclick = (e) => {\r\n\r\n\t\t\treader.emit(\"sidebaropener\", false);\r\n\t\t\te.preventDefault();\r\n\t\t\topenerBtn.dom.blur();\r\n\t\t};\r\n\t\topenerBox.add(openerBtn);\r\n\t\tcontainer.addMenu(openerBox);\r\n\r\n\t\tcontainer.addTab(\"btn-t\", strings.get(keys[1]), new TocPanel(reader));\r\n\t\tif (controls.bookmarks) {\r\n\t\t\tcontainer.addTab(\"btn-d\", strings.get(keys[2]), new BookmarksPanel(reader));\r\n\t\t}\r\n\t\tif (controls.annotations) {\r\n\t\t\tcontainer.addTab(\"btn-a\", strings.get(keys[3]), new AnnotationsPanel(reader));\r\n\t\t}\r\n\t\tcontainer.addTab(\"btn-s\", strings.get(keys[4]), new SearchPanel(reader));\r\n\t\tcontainer.addTab(\"btn-c\", strings.get(keys[5]), new SettingsPanel(reader));\r\n\t\tcontainer.addTab(\"btn-i\", strings.get(keys[6]), new MetadataPanel(reader));\r\n\t\tcontainer.select(\"btn-t\");\r\n\r\n\t\tdocument.body.appendChild(container.dom);\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on(\"sidebaropener\", (value) => {\r\n\r\n\t\t\tif (value) {\r\n\t\t\t\tcontainer.setClass(\"open\");\r\n\t\t\t} else {\r\n\t\t\t\tcontainer.removeAttribute(\"class\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on(\"languagechanged\", (value) => {\r\n\r\n\t\t\topenerBtn.setTitle(strings.get(keys[0]));\r\n\t\t\tcontainer.setLabel(\"btn-t\", strings.get(keys[1]));\r\n\t\t\tif (controls.bookmarks) {\r\n\t\t\t\tcontainer.setLabel(\"btn-d\", strings.get(keys[2]));\r\n\t\t\t}\r\n\t\t\tif (controls.annotations) {\r\n\t\t\t\tcontainer.setLabel(\"btn-a\", strings.get(keys[3]));\r\n\t\t\t}\r\n\t\t\tcontainer.setLabel(\"btn-s\", strings.get(keys[4]));\r\n\t\t\tcontainer.setLabel(\"btn-c\", strings.get(keys[5]));\r\n\t\t\tcontainer.setLabel(\"btn-i\", strings.get(keys[6]));\r\n\t\t});\r\n\t}\r\n}","import { uuid } from \"./utils.js\";\r\nimport { UIBox, UIDiv, UIInput, UILabel } from \"./ui.js\";\r\n\r\nexport class NoteDlg {\r\n\r\n    constructor(reader) {\r\n\r\n        const container = new UIDiv().setId(\"notedlg\");\r\n        const strings = reader.strings;\r\n        const keys = [\r\n            \"notedlg/label\",\r\n            \"notedlg/add\"\r\n        ];\r\n        const label = new UILabel(strings.get(keys[0]), \"note-input\");\r\n        const textBox = new UIInput(\"text\", \"\").setId(\"note-input\");\r\n        textBox.dom.oninput = (e) => {\r\n\r\n            this.update();\r\n            e.preventDefault();\r\n        };\r\n\r\n        const addBtn = new UIInput(\"button\", strings.get(keys[1]));\r\n        addBtn.dom.disabled = true;\r\n        addBtn.dom.onclick = (e) => {\r\n\r\n            const note = {\r\n                cfi: this.cfi,\r\n                date: new Date(),\r\n                text: textBox.getValue(),\r\n                uuid: uuid()\r\n            };\r\n            this.range = undefined;\r\n            reader.settings.annotations.push(note);\r\n            reader.emit(\"noteadded\", note);\r\n            container.removeAttribute(\"class\");\r\n            e.preventDefault();\r\n            addBtn.dom.blur();\r\n        };\r\n\r\n        this.update = () => {\r\n\r\n            addBtn.dom.disabled = !(this.range && textBox.getValue().length > 0);\r\n        };\r\n\r\n        container.add(new UIBox([label, textBox, addBtn]).addClass(\"control\"));\r\n        document.body.appendChild(container.dom);\r\n\r\n        //-- events --//\r\n\r\n        reader.on(\"selected\", (cfi, contents) => {\r\n\r\n            this.cfi = cfi;\r\n            this.range = contents.range(cfi);\r\n            this.update();\r\n            container.setClass(\"open\");\r\n            textBox.setValue(\"\");\r\n        });\r\n\r\n        reader.on(\"unselected\", () => {\r\n\r\n            this.range = undefined;\r\n            this.update();\r\n            container.removeAttribute(\"class\");\r\n        });\r\n\r\n        reader.on(\"languagechanged\", (value) => {\r\n\r\n            label.setTextContent(strings.get(keys[0]));\r\n            addBtn.setValue(strings.get(keys[1]));\r\n        });\r\n    }\r\n}","import EventEmitter from \"event-emitter\";\r\n\r\nimport { extend, detectMobile } from \"./utils.js\";\r\nimport { Storage } from \"./storage.js\";\r\nimport { Strings } from \"./strings.js\";\r\nimport { Toolbar } from \"./toolbar.js\";\r\nimport { Content } from \"./content.js\";\r\nimport { Sidebar } from \"./sidebar.js\";\r\nimport { NoteDlg } from \"./notedlg.js\";\r\n\r\nexport class Reader {\r\n\r\n\tconstructor(bookPath, settings) {\r\n\r\n\t\tconst preinit = (data) => {\r\n\t\t\tconst url = new URL(window.location);\r\n\t\t\tlet path = bookPath;\r\n\t\t\tif (settings && !settings.openbook) {\r\n\t\t\t\tpath = bookPath;\r\n\t\t\t\tif (data) this.storage.clear();\r\n\t\t\t} else if (data && url.search.length === 0) {\r\n\t\t\t\tpath = data;\r\n\t\t\t}\r\n\t\t\tthis.cfgInit(path, settings);\r\n\t\t\tthis.strings = new Strings(this);\r\n\t\t\tthis.toolbar = new Toolbar(this);\r\n\t\t\tthis.content = new Content(this);\r\n\t\t\tthis.sidebar = new Sidebar(this);\r\n\t\t\tif (this.settings.annotations) {\r\n\t\t\t\tthis.notedlg = new NoteDlg(this);\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\r\n\t\tthis.settings = undefined;\r\n\t\tthis.isMobile = detectMobile();\r\n\t\tthis.storage = new Storage();\r\n\t\tconst openbook = settings && settings.openbook;\r\n\r\n\t\tif (this.storage.indexedDB && (!settings || openbook)) {\r\n\t\t\tthis.storage.init(() => this.storage.get((data) => preinit(data)));\r\n\t\t} else {\r\n\t\t\tpreinit();\r\n\t\t}\r\n\r\n\t\twindow.onbeforeunload = this.unload.bind(this);\r\n\t\twindow.onhashchange = this.hashChanged.bind(this);\r\n\t\twindow.onkeydown = this.keyboardHandler.bind(this);\r\n\t\twindow.onwheel = (e) => {\r\n\t\t\tif (e.ctrlKey) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Initialize book.\r\n\t * @param {*} bookPath\r\n\t * @param {*} settings\r\n\t */\r\n\tinit(bookPath, settings) {\r\n\r\n\t\tthis.emit(\"viewercleanup\");\r\n\t\tthis.navItems = {};\r\n\r\n\t\tif (arguments.length > 0) {\r\n\r\n\t\t\tthis.cfgInit(bookPath, settings);\r\n\t\t}\r\n\r\n\t\tthis.book = ePub(this.settings.bookPath);\r\n\t\tthis.rendition = this.book.renderTo(\"viewer\", {\r\n\t\t\tmanager: this.settings.manager,\r\n\t\t\tflow: this.settings.flow,\r\n\t\t\tspread: this.settings.spread.mod,\r\n\t\t\tminSpreadWidth: this.settings.spread.min,\r\n\t\t\twidth: \"100%\",\r\n\r\n\t\t\t//script:\"https://hypothes.is/embed.js\",\r\n\t\t\t//allowScriptedContent: true,\r\n\r\n\r\n\t\t\theight: \"100%\",\r\n\t\t\tsnap: true\r\n\t\t});\r\n\r\n\t\tconst cfi = this.settings.previousLocationCfi;\r\n\t\tif (cfi) {\r\n\t\t\tthis.displayed = this.rendition.display(cfi);\r\n\t\t} else {\r\n\t\t\tthis.displayed = this.rendition.display();\r\n\t\t}\r\n\r\n\t\tthis.displayed.then((renderer) => {\r\n\t\t\tthis.emit(\"displayed\", renderer, this.settings);\r\n\t\t});\r\n\r\n\t\tthis.book.ready.then(() => {\r\n\t\t\tthis.emit(\"bookready\", this.settings);\r\n\t\t}).then(() => {\r\n\t\t\tthis.emit(\"bookloaded\");\r\n\t\t});\r\n\r\n\t\tthis.book.loaded.metadata.then((meta) => {\r\n\t\t\tthis.emit(\"metadata\", meta);\r\n\t\t});\r\n\r\n\t\tthis.book.loaded.navigation.then((toc) => {\r\n\t\t\tthis.emit(\"navigation\", toc);\r\n\t\t});\r\n\r\n\t\tthis.rendition.on(\"click\", (e) => {\r\n\t\t\tconst selection = e.view.document.getSelection();\r\n\t\t\tif (selection.type !== \"Range\") {\r\n\t\t\t\tthis.emit(\"unselected\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.rendition.on(\"layout\", (props) => {\r\n\t\t\tthis.emit(\"layout\", props);\r\n\t\t});\r\n\r\n\t\tthis.rendition.on(\"selected\", (cfiRange, contents) => {\r\n\t\t\tthis.setLocation(cfiRange);\r\n\t\t\tthis.emit(\"selected\", cfiRange, contents);\r\n\t\t});\r\n\r\n\t\tthis.rendition.on(\"relocated\", (location) => {\r\n\t\t\tthis.setLocation(location.start.cfi);\r\n\t\t\tthis.emit(\"relocated\", location);\r\n\t\t});\r\n\r\n\t\tthis.rendition.on(\"keydown\", this.keyboardHandler.bind(this));\r\n\r\n\t\t// Avoid excessive callback assign!\r\n\r\n\t\tif (!this.first_time_runned) {\r\n\t\t\tthis.first_time_runned = true;\r\n\r\n\t\t\tthis.on(\"prev\", () => {\r\n\t\t\t\tif (this.book.package.metadata.direction === \"rtl\") {\r\n\t\t\t\t\tthis.rendition.next();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.rendition.prev();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.on(\"next\", () => {\r\n\t\t\t\tif (this.book.package.metadata.direction === \"rtl\") {\r\n\t\t\t\t\tthis.rendition.prev();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.rendition.next();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.on(\"languagechanged\", (value) => {\r\n\t\t\t\tthis.settings.language = value;\r\n\t\t\t});\r\n\r\n\t\t\tthis.on(\"flowchanged\", (value) => {\r\n\t\t\t\tthis.settings.flow = value;\r\n\t\t\t\tthis.rendition.flow(value);\r\n\t\t\t});\r\n\r\n\t\t\tthis.on(\"spreadchanged\", (value) => {\r\n\t\t\t\tconst mod = value.mod || this.settings.spread.mod;\r\n\t\t\t\tconst min = value.min || this.settings.spread.min;\r\n\t\t\t\tthis.settings.spread.mod = mod;\r\n\t\t\t\tthis.settings.spread.min = min;\r\n\t\t\t\tthis.rendition.spread(mod, min);\r\n\t\t\t});\r\n\r\n\t\t\tthis.on(\"styleschanged\", (value) => {\r\n\t\t\t\tconst fontSize = value.fontSize;\r\n\t\t\t\tthis.settings.styles.fontSize = fontSize;\r\n\t\t\t\tthis.rendition.themes.fontSize(fontSize + \"%\");\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/* ------------------------------- Common ------------------------------- */\r\n\r\n\tnavItemFromCfi(cfi) {\r\n\r\n\t\t// This feature was added to solve the problem of duplicate titles in \r\n\t\t// bookmarks. But this still has no solution because when reloading the \r\n\t\t// reader, rendition cannot get the range from the previously saved CFI.\r\n\t\tconst range = this.rendition.getRange(cfi);\r\n\t\tconst idref = range ? range.startContainer.parentNode.id : undefined;\r\n\t\tconst location = this.rendition.currentLocation();\r\n\t\tconst href = location.start.href;\r\n\t\treturn this.navItems[href + \"#\" + idref] || this.navItems[href];\r\n\t}\r\n\r\n\t/* ------------------------------ Bookmarks ----------------------------- */\r\n\r\n\t/**\r\n\t * Verifying the current page in bookmarks.\r\n\t * @param {*} cfi\r\n\t * @returns The index of the bookmark if it exists, or -1 otherwise.\r\n\t */\r\n\tisBookmarked(cfi) {\r\n\r\n\t\treturn this.settings.bookmarks.indexOf(cfi);\r\n\t}\r\n\r\n\t/* ----------------------------- Annotations ---------------------------- */\r\n\r\n\tisAnnotated(note) {\r\n\r\n\t\treturn this.settings.annotations.indexOf(note);\r\n\t}\r\n\r\n\t/* ------------------------------ Settings ------------------------------ */\r\n\r\n\t/**\r\n\t * Initialize book settings.\r\n\t * @param {any} bookPath\r\n\t * @param {any} settings\r\n\t */\r\n\tcfgInit(bookPath, settings) {\r\n\r\n\t\tthis.entryKey = md5(bookPath).toString();\r\n\t\tthis.settings = {\r\n\t\t\tbookPath: bookPath,\r\n\t\t\tarrows: this.isMobile ? \"none\" : \"content\", // none | content | toolbar\r\n\t\t\tmanager: this.isMobile ? \"continuous\" : \"default\",\r\n\t\t\trestore: true,\r\n\t\t\thistory: true,\r\n\t\t\topenbook: this.storage.indexedDB ? true : false,\r\n\t\t\tlanguage: \"en\",\r\n\t\t\tsectionId: undefined,\r\n\t\t\tbookmarks: [],   // array | false\r\n\t\t\tannotations: [], // array | false\r\n\t\t\tflow: \"paginated\", // paginated | scrolled\r\n\t\t\tspread: {\r\n\t\t\t\tmod: \"auto\", // auto | none\r\n\t\t\t\tmin: 800\r\n\t\t\t},\r\n\t\t\tstyles: {\r\n\t\t\t\tfontSize: 100\r\n\t\t\t},\r\n\t\t\tpagination: undefined, // not implemented\r\n\t\t\tfullscreen: document.fullscreenEnabled\r\n\t\t};\r\n\r\n\t\textend(settings || {}, this.settings);\r\n\r\n\t\tif (this.settings.restore) {\r\n\t\t\tthis.applySavedSettings(settings || {});\r\n\t\t} else {\r\n\t\t\tthis.removeSavedSettings();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the book setting can be retrieved from localStorage.\r\n\t * @returns true if the book key exists, or false otherwise.\r\n\t */\r\n\tisSaved() {\r\n\r\n\t\treturn localStorage && localStorage.getItem(this.entryKey) !== null;\r\n\t}\r\n\r\n\t/**\r\n\t * Removing the current book settings from local storage.\r\n\t * @returns true if the book settings were deleted successfully, or false\r\n\t * otherwise.\r\n\t */\r\n\tremoveSavedSettings() {\r\n\r\n\t\tif (!this.isSaved())\r\n\t\t\treturn false;\r\n\r\n\t\tlocalStorage.removeItem(this.entryKey);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies saved settings from local storage.\r\n\t * @param {*} external External settings\r\n\t * @returns True if the settings were applied successfully, false otherwise.\r\n\t */\r\n\tapplySavedSettings(external) {\r\n\r\n\t\tif (!this.isSaved())\r\n\t\t\treturn false;\r\n\r\n\t\tlet stored;\r\n\t\ttry {\r\n\t\t\tstored = JSON.parse(localStorage.getItem(this.entryKey));\r\n\t\t} catch (e) {\r\n\t\t\tconsole.exception(e);\r\n\t\t}\r\n\r\n\t\tif (stored) {\r\n\t\t\textend(stored, this.settings, external);\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Saving the current book settings in local storage.\r\n\t */\r\n\tsaveSettings() {\r\n\r\n\t\tthis.settings.previousLocationCfi = this.rendition.location.start.cfi;\r\n\t\tconst cfg = Object.assign({}, this.settings);\r\n\t\tdelete cfg.arrows;\r\n\t\tdelete cfg.manager;\r\n\t\tdelete cfg.history;\r\n\t\tdelete cfg.restore;\r\n\t\tdelete cfg.openbook;\r\n\t\tdelete cfg.pagination;\r\n\t\tdelete cfg.fullscreen;\r\n\t\tlocalStorage.setItem(this.entryKey, JSON.stringify(cfg));\r\n\t}\r\n\r\n\tsetLocation(cfi) {\r\n\r\n\t\tconst baseUrl = this.book.archived ? undefined : this.book.url;\r\n\t\tconst url = new URL(window.location, baseUrl);\r\n\t\turl.hash = \"#\" + cfi;\r\n\r\n\t\t// Update the History Location\r\n\t\tif (this.settings.history && window.location.hash !== url.hash) {\r\n\t\t\t// Add CFI fragment to the history\r\n\t\t\twindow.history.pushState({}, \"\", url);\r\n\t\t\tthis.currentLocationCfi = cfi;\r\n\t\t}\r\n\t}\r\n\r\n\t//-- event handlers --//\r\n\r\n\tunload() {\r\n\r\n\t\tif (this.settings.restore && localStorage) {\r\n\t\t\tthis.saveSettings();\r\n\t\t}\r\n\t}\r\n\r\n\thashChanged() {\r\n\r\n\t\tconst hash = window.location.hash.slice(1);\r\n\t\tthis.rendition.display(hash);\r\n\t}\r\n\r\n\tkeyboardHandler(e) {\r\n\r\n\t\tconst step = 2;\r\n\t\tlet value = this.settings.styles.fontSize;\r\n\r\n\t\tswitch (e.key) {\r\n\r\n\t\t\tcase \"=\":\r\n\t\t\tcase \"+\":\r\n\t\t\t\tvalue += step;\r\n\t\t\t\tthis.emit(\"styleschanged\", { fontSize: value });\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"-\":\r\n\t\t\t\tvalue -= step;\r\n\t\t\t\tthis.emit(\"styleschanged\", { fontSize: value });\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"0\":\r\n\t\t\t\tvalue = 100;\r\n\t\t\t\tthis.emit(\"styleschanged\", { fontSize: value });\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ArrowLeft\":\r\n\t\t\t\tthis.emit(\"prev\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ArrowRight\":\r\n\t\t\t\tthis.emit(\"next\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nEventEmitter(Reader.prototype);"],"names":[],"sourceRoot":""}